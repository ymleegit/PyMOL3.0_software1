

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pymol_util &mdash; Will&#39;s PyMOL Scripts 0.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Will&#39;s PyMOL Scripts 0.2 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Will&#39;s PyMOL Scripts 0.2 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pymol_util</h1><div class="highlight"><pre>
<span class="c"># -*- mode:python;tab-width:2;indent-tabs-mode:t;show-trailing-whitespace:t;rm-trailing-spaces:t -*-</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">os</span><span class="o">,</span><span class="nn">inspect</span>
<span class="n">newpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span> <span class="c"># script directory</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">newpath</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newpath</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">string</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">gzip</span><span class="o">,</span> <span class="nn">itertools</span><span class="o">,</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">sets</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randrange</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">import</span> <span class="nn">xyzMath</span> <span class="kn">as</span> <span class="nn">xyz</span>
<span class="kn">from</span> <span class="nn">xyzMath</span> <span class="kn">import</span> <span class="n">Ux</span><span class="p">,</span><span class="n">Uy</span><span class="p">,</span><span class="n">Uz</span><span class="p">,</span><span class="n">Imat</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="k">try</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">pymol</span> <span class="kn">import</span> <span class="n">cmd</span>
	<span class="kn">from</span> <span class="nn">pymol</span> <span class="kn">import</span> <span class="n">cgo</span> 
<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
	<span class="k">print</span> <span class="n">e</span>
	<span class="k">print</span> <span class="s">&quot;can&#39;t load pymol, Mocking it for testing/doc&quot;</span>
	<span class="kn">from</span> <span class="nn">minimock</span> <span class="kn">import</span> <span class="n">Mock</span>
	<span class="n">cmd</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="s">&quot;cmd&quot;</span><span class="p">)</span>
	<span class="n">cgo</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="s">&quot;cgo&quot;</span><span class="p">)</span>


<span class="n">numcom</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">numvec</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">COLORS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;cyan&#39;</span><span class="p">,</span> <span class="s">&#39;lightmagenta&#39;</span><span class="p">,</span> <span class="s">&#39;yellow&#39;</span><span class="p">,</span> <span class="s">&#39;salmon&#39;</span><span class="p">,</span> <span class="s">&#39;hydrogen&#39;</span><span class="p">,</span> <span class="s">&#39;slate&#39;</span><span class="p">,</span> <span class="s">&#39;orange&#39;</span><span class="p">,</span>
 <span class="s">&#39;lime&#39;</span><span class="p">,</span>
 <span class="s">&#39;deepteal&#39;</span><span class="p">,</span>
 <span class="s">&#39;hotpink&#39;</span><span class="p">,</span>
 <span class="s">&#39;yelloworange&#39;</span><span class="p">,</span>
 <span class="s">&#39;violetpurple&#39;</span><span class="p">,</span>
 <span class="s">&#39;grey70&#39;</span><span class="p">,</span>
 <span class="s">&#39;marine&#39;</span><span class="p">,</span>
 <span class="s">&#39;olive&#39;</span><span class="p">,</span>
 <span class="s">&#39;smudge&#39;</span><span class="p">,</span>
 <span class="s">&#39;teal&#39;</span><span class="p">,</span>
 <span class="s">&#39;dirtyviolet&#39;</span><span class="p">,</span>
 <span class="s">&#39;wheat&#39;</span><span class="p">,</span>
 <span class="s">&#39;deepsalmon&#39;</span><span class="p">,</span>
 <span class="s">&#39;lightpink&#39;</span><span class="p">,</span>
 <span class="s">&#39;aquamarine&#39;</span><span class="p">,</span>
 <span class="s">&#39;paleyellow&#39;</span><span class="p">,</span>
 <span class="s">&#39;limegreen&#39;</span><span class="p">,</span>
 <span class="s">&#39;skyblue&#39;</span><span class="p">,</span>
 <span class="s">&#39;warmpink&#39;</span><span class="p">,</span>
 <span class="s">&#39;limon&#39;</span><span class="p">,</span>
 <span class="s">&#39;violet&#39;</span><span class="p">,</span>
 <span class="s">&#39;bluewhite&#39;</span><span class="p">,</span>
 <span class="s">&#39;greencyan&#39;</span><span class="p">,</span>
 <span class="s">&#39;sand&#39;</span><span class="p">,</span>
 <span class="s">&#39;forest&#39;</span><span class="p">,</span>
 <span class="s">&#39;lightteal&#39;</span><span class="p">,</span>
 <span class="s">&#39;darksalmon&#39;</span><span class="p">,</span>
 <span class="s">&#39;splitpea&#39;</span><span class="p">,</span>
 <span class="s">&#39;raspberry&#39;</span><span class="p">,</span>
 <span class="s">&#39;grey50&#39;</span><span class="p">,</span>
 <span class="s">&#39;deepblue&#39;</span><span class="p">,</span>
 <span class="s">&#39;brown&#39;</span><span class="p">)</span>
<span class="n">COLORS</span> <span class="o">+=</span> <span class="n">COLORS</span> <span class="o">+</span> <span class="n">COLORS</span> <span class="o">+</span> <span class="n">COLORS</span>

<span class="n">aa_1_3</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;A&#39;</span><span class="p">:</span> <span class="s">&#39;ALA&#39;</span><span class="p">,</span>
		  <span class="s">&#39;C&#39;</span><span class="p">:</span> <span class="s">&#39;CYS&#39;</span><span class="p">,</span>
		  <span class="s">&#39;D&#39;</span><span class="p">:</span> <span class="s">&#39;ASP&#39;</span><span class="p">,</span>
		  <span class="s">&#39;E&#39;</span><span class="p">:</span> <span class="s">&#39;GLU&#39;</span><span class="p">,</span>
		  <span class="s">&#39;F&#39;</span><span class="p">:</span> <span class="s">&#39;PHE&#39;</span><span class="p">,</span>
		  <span class="s">&#39;G&#39;</span><span class="p">:</span> <span class="s">&#39;GLY&#39;</span><span class="p">,</span>
		  <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="s">&#39;HIS&#39;</span><span class="p">,</span>
		  <span class="s">&#39;I&#39;</span><span class="p">:</span> <span class="s">&#39;ILE&#39;</span><span class="p">,</span>
		  <span class="s">&#39;K&#39;</span><span class="p">:</span> <span class="s">&#39;LYS&#39;</span><span class="p">,</span>
		  <span class="s">&#39;L&#39;</span><span class="p">:</span> <span class="s">&#39;LEU&#39;</span><span class="p">,</span>
		  <span class="s">&#39;xyz.Mat&#39;</span><span class="p">:</span> <span class="s">&#39;MET&#39;</span><span class="p">,</span>
		  <span class="s">&#39;N&#39;</span><span class="p">:</span> <span class="s">&#39;ASN&#39;</span><span class="p">,</span>
		  <span class="s">&#39;P&#39;</span><span class="p">:</span> <span class="s">&#39;PRO&#39;</span><span class="p">,</span>
		  <span class="s">&#39;R&#39;</span><span class="p">:</span> <span class="s">&#39;ARG&#39;</span><span class="p">,</span>
		  <span class="s">&#39;Q&#39;</span><span class="p">:</span> <span class="s">&#39;GLN&#39;</span><span class="p">,</span>
		  <span class="s">&#39;S&#39;</span><span class="p">:</span> <span class="s">&#39;SER&#39;</span><span class="p">,</span>
		  <span class="s">&#39;T&#39;</span><span class="p">:</span> <span class="s">&#39;THR&#39;</span><span class="p">,</span>
		  <span class="s">&#39;xyz.Vec&#39;</span><span class="p">:</span> <span class="s">&#39;VAL&#39;</span><span class="p">,</span>
		  <span class="s">&#39;W&#39;</span><span class="p">:</span> <span class="s">&#39;TRP&#39;</span><span class="p">,</span>
		  <span class="s">&#39;Uy&#39;</span><span class="p">:</span> <span class="s">&#39;TYR&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">aa_3_1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;ALA&#39;</span><span class="p">:</span> <span class="s">&#39;A&#39;</span><span class="p">,</span>
		  <span class="s">&#39;ASP&#39;</span><span class="p">:</span> <span class="s">&#39;D&#39;</span><span class="p">,</span>
		  <span class="s">&#39;GLU&#39;</span><span class="p">:</span> <span class="s">&#39;E&#39;</span><span class="p">,</span>
		  <span class="s">&#39;CYS&#39;</span><span class="p">:</span> <span class="s">&#39;C&#39;</span><span class="p">,</span>
		  <span class="s">&#39;PHE&#39;</span><span class="p">:</span> <span class="s">&#39;F&#39;</span><span class="p">,</span>
		  <span class="s">&#39;GLY&#39;</span><span class="p">:</span> <span class="s">&#39;G&#39;</span><span class="p">,</span>
		  <span class="s">&#39;HIS&#39;</span><span class="p">:</span> <span class="s">&#39;H&#39;</span><span class="p">,</span>
		  <span class="s">&#39;ILE&#39;</span><span class="p">:</span> <span class="s">&#39;I&#39;</span><span class="p">,</span>
		  <span class="s">&#39;LYS&#39;</span><span class="p">:</span> <span class="s">&#39;K&#39;</span><span class="p">,</span>
		  <span class="s">&#39;LEU&#39;</span><span class="p">:</span> <span class="s">&#39;L&#39;</span><span class="p">,</span>
		  <span class="s">&#39;MET&#39;</span><span class="p">:</span> <span class="s">&#39;xyz.Mat&#39;</span><span class="p">,</span>
		  <span class="s">&#39;ASN&#39;</span><span class="p">:</span> <span class="s">&#39;N&#39;</span><span class="p">,</span>
		  <span class="s">&#39;PRO&#39;</span><span class="p">:</span> <span class="s">&#39;P&#39;</span><span class="p">,</span>
		  <span class="s">&#39;GLN&#39;</span><span class="p">:</span> <span class="s">&#39;Q&#39;</span><span class="p">,</span>
		  <span class="s">&#39;ARG&#39;</span><span class="p">:</span> <span class="s">&#39;R&#39;</span><span class="p">,</span>
		  <span class="s">&#39;SER&#39;</span><span class="p">:</span> <span class="s">&#39;S&#39;</span><span class="p">,</span>
		  <span class="s">&#39;THR&#39;</span><span class="p">:</span> <span class="s">&#39;T&#39;</span><span class="p">,</span>
		  <span class="s">&#39;VAL&#39;</span><span class="p">:</span> <span class="s">&#39;xyz.Vec&#39;</span><span class="p">,</span>
		  <span class="s">&#39;TRP&#39;</span><span class="p">:</span> <span class="s">&#39;W&#39;</span><span class="p">,</span>
		  <span class="s">&#39;TYR&#39;</span><span class="p">:</span> <span class="s">&#39;Uy&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">aa_types</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">&#39;A&#39;</span><span class="p">:</span> <span class="s">&#39;hydrophobic&#39;</span><span class="p">,</span>
  <span class="s">&#39;C&#39;</span><span class="p">:</span> <span class="s">&#39;cysteine&#39;</span><span class="p">,</span>
  <span class="s">&#39;D&#39;</span><span class="p">:</span> <span class="s">&#39;negative&#39;</span><span class="p">,</span>
  <span class="s">&#39;E&#39;</span><span class="p">:</span> <span class="s">&#39;negative&#39;</span><span class="p">,</span>
  <span class="s">&#39;F&#39;</span><span class="p">:</span> <span class="s">&#39;aromatic&#39;</span><span class="p">,</span>
  <span class="s">&#39;G&#39;</span><span class="p">:</span> <span class="s">&#39;hydrophobic&#39;</span><span class="p">,</span>
  <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="s">&#39;polar&#39;</span><span class="p">,</span>
  <span class="s">&#39;I&#39;</span><span class="p">:</span> <span class="s">&#39;hydrophobic&#39;</span><span class="p">,</span>
  <span class="s">&#39;K&#39;</span><span class="p">:</span> <span class="s">&#39;positive&#39;</span><span class="p">,</span>
  <span class="s">&#39;L&#39;</span><span class="p">:</span> <span class="s">&#39;hydrophobic&#39;</span><span class="p">,</span>
  <span class="s">&#39;xyz.Mat&#39;</span><span class="p">:</span> <span class="s">&#39;hydrophobic&#39;</span><span class="p">,</span>
  <span class="s">&#39;N&#39;</span><span class="p">:</span> <span class="s">&#39;polar&#39;</span><span class="p">,</span>
  <span class="s">&#39;P&#39;</span><span class="p">:</span> <span class="s">&#39;proline&#39;</span><span class="p">,</span>
  <span class="s">&#39;Q&#39;</span><span class="p">:</span> <span class="s">&#39;polar&#39;</span><span class="p">,</span>
  <span class="s">&#39;R&#39;</span><span class="p">:</span> <span class="s">&#39;positive&#39;</span><span class="p">,</span>
  <span class="s">&#39;S&#39;</span><span class="p">:</span> <span class="s">&#39;polar&#39;</span><span class="p">,</span>
  <span class="s">&#39;T&#39;</span><span class="p">:</span> <span class="s">&#39;polar&#39;</span><span class="p">,</span>
  <span class="s">&#39;xyz.Vec&#39;</span><span class="p">:</span> <span class="s">&#39;phydrophobic&#39;</span><span class="p">,</span>
  <span class="s">&#39;W&#39;</span><span class="p">:</span> <span class="s">&#39;aromatic&#39;</span><span class="p">,</span>
  <span class="s">&#39;Uy&#39;</span><span class="p">:</span> <span class="s">&#39;aromatic&#39;</span><span class="p">,</span>
<span class="p">}</span>

<div class="viewcode-block" id="showaxes"><a class="viewcode-back" href="../pymol_util.html#pymol_util.showaxes">[docs]</a><span class="k">def</span> <span class="nf">showaxes</span><span class="p">():</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">BEGIN</span><span class="p">,</span> <span class="n">LINES</span><span class="p">,</span>
        <span class="n">COLOR</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> 
        <span class="n">VERTEX</span><span class="p">,</span>   <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">VERTEX</span><span class="p">,</span>  <span class="mf">20.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">COLOR</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> 
        <span class="n">VERTEX</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>   <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">VERTEX</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">20.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> 
        <span class="n">COLOR</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> 
        <span class="n">VERTEX</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>   <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">VERTEX</span><span class="p">,</span> <span class="mo">00</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>   <span class="mf">20.0</span><span class="p">,</span>
        <span class="n">END</span>
        <span class="p">]</span>                                                                                            
    <span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="s">&#39;axes&#39;</span><span class="p">)</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="showaxes2"><a class="viewcode-back" href="../pymol_util.html#pymol_util.showaxes2">[docs]</a><span class="k">def</span> <span class="nf">showaxes2</span><span class="p">():</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">BEGIN</span><span class="p">,</span> <span class="n">LINES</span><span class="p">,</span>
        <span class="n">COLOR</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> 
        <span class="n">VERTEX</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">VERTEX</span><span class="p">,</span>  <span class="mf">20.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">COLOR</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> 
        <span class="n">VERTEX</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">VERTEX</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>  <span class="mf">20.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> 
        <span class="n">COLOR</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> 
        <span class="n">VERTEX</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.0</span><span class="p">,</span>
        <span class="n">VERTEX</span><span class="p">,</span> <span class="mo">00</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>   <span class="mf">20.0</span><span class="p">,</span>
        <span class="n">END</span>
        <span class="p">]</span>                                                                                            
    <span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="s">&#39;axes&#39;</span><span class="p">)</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="getchain"><a class="viewcode-back" href="../pymol_util.html#pymol_util.getchain">[docs]</a><span class="k">def</span> <span class="nf">getchain</span><span class="p">(</span><span class="n">sele</span><span class="p">):</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">c</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sets</span><span class="o">.</span><span class="n">Set</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">chain</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sele</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">]))</span>
		<span class="n">c</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">c</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="k">return</span> <span class="p">[]</span>

</div>
<div class="viewcode-block" id="getres"><a class="viewcode-back" href="../pymol_util.html#pymol_util.getres">[docs]</a><span class="k">def</span> <span class="nf">getres</span><span class="p">(</span><span class="n">sele</span><span class="p">):</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sets</span><span class="o">.</span><span class="n">Set</span><span class="p">([(</span><span class="n">x</span><span class="o">.</span><span class="n">chain</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">resi</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sele</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">]))</span>
		<span class="n">r</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">r</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="k">return</span> <span class="p">[]</span>

</div>
<div class="viewcode-block" id="com"><a class="viewcode-back" href="../pymol_util.html#pymol_util.com">[docs]</a><span class="k">def</span> <span class="nf">com</span><span class="p">(</span><span class="n">sel</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
	<span class="c">## assumes equal weights (best called with &quot;and name ca&quot; suffix)</span>
	<span class="n">model</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
	<span class="n">c</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">atom</span><span class="p">:</span>
		<span class="n">c</span> <span class="o">+=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
	<span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">c</span>

</div>
<div class="viewcode-block" id="showcom"><a class="viewcode-back" href="../pymol_util.html#pymol_util.showcom">[docs]</a><span class="k">def</span> <span class="nf">showcom</span><span class="p">(</span><span class="n">sel</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">):</span>
	<span class="k">global</span> <span class="n">numcom</span>
	<span class="n">c</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
	<span class="k">print</span> <span class="s">&quot;Center of mass: &quot;</span><span class="p">,</span> <span class="n">c</span>
	<span class="n">cgo</span> <span class="o">=</span> <span class="p">[</span><span class="n">pymol</span><span class="o">.</span><span class="n">cgo</span><span class="o">.</span><span class="n">COLOR</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">SPHERE</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span> <span class="c">## white sphere with 3A radius</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">cgo</span><span class="p">,</span> <span class="s">&quot;com</span><span class="si">%i</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">numcom</span><span class="p">)</span>
	<span class="n">numcom</span> <span class="o">+=</span> <span class="mi">1</span>

</div>
<div class="viewcode-block" id="showvec"><a class="viewcode-back" href="../pymol_util.html#pymol_util.showvec">[docs]</a><span class="k">def</span> <span class="nf">showvec</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">lab</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">lab</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
		<span class="k">global</span> <span class="n">numvec</span>
		<span class="n">lab</span> <span class="o">=</span> <span class="s">&quot;vec</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">numvec</span>
		<span class="n">numvec</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="n">cgo</span> <span class="o">=</span> <span class="p">[</span><span class="n">COLOR</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">SPHERE</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span> <span class="c">## white sphere with 3A radius</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">cgo</span><span class="p">,</span><span class="n">lab</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="showvecfrompoint"><a class="viewcode-back" href="../pymol_util.html#pymol_util.showvecfrompoint">[docs]</a><span class="k">def</span> <span class="nf">showvecfrompoint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">lbl</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">([</span><span class="n">COLOR</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span>
				  <span class="n">SPHERE</span><span class="p">,</span>   <span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>       <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>       <span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>    <span class="mf">0.2</span><span class="p">,</span>
				  <span class="n">CYLINDER</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>       <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>       <span class="n">c</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
							<span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
					<span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">],</span> <span class="n">lbl</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ResBB"><a class="viewcode-back" href="../pymol_util.html#pymol_util.ResBB">[docs]</a><span class="k">class</span> <span class="nc">ResBB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;docstring for ResBB&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">ca</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">ss</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">ResBB</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
		<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">is</span> <span class="n">ResBB</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">n</span>  <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">n</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">ca</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">c</span>  <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">c</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ss</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">ss</span>
			<span class="k">return</span>
		<span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">):</span>
			<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">getres</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="ow">is</span> <span class="mi">1</span>
			<span class="n">m</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">n</span>  <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span> <span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span> <span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span> <span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span> <span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">c</span>  <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span> <span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span> <span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ss</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ss</span>
			<span class="k">return</span>
		<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">is</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span>
		<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">ca</span><span class="p">)</span> <span class="ow">is</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span>
		<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">is</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">n</span>  <span class="o">=</span> <span class="n">n</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="n">ca</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">c</span>  <span class="o">=</span> <span class="n">c</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ss</span> <span class="o">=</span> <span class="n">ss</span>
<div class="viewcode-block" id="ResBB.rms"><a class="viewcode-back" href="../pymol_util.html#pymol_util.ResBB.rms">[docs]</a>	<span class="k">def</span> <span class="nf">rms</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
		<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">is</span> <span class="n">ResBB</span>
		<span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">n</span><span class="o">-</span><span class="n">o</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">n</span><span class="o">-</span><span class="n">o</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ca</span><span class="o">-</span><span class="n">o</span><span class="o">.</span><span class="n">ca</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ca</span><span class="o">-</span><span class="n">o</span><span class="o">.</span><span class="n">ca</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">-</span><span class="n">o</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">c</span><span class="o">-</span><span class="n">o</span><span class="o">.</span><span class="n">c</span><span class="p">)</span> <span class="p">)</span></div>
	<span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">ResBB</span><span class="p">(</span> <span class="n">m</span><span class="o">*</span><span class="n">r</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="o">*</span><span class="n">r</span><span class="o">.</span><span class="n">ca</span><span class="p">,</span> <span class="n">m</span><span class="o">*</span><span class="n">r</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">ss</span> <span class="p">)</span>
	<span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">ResBB</span><span class="p">(</span> <span class="n">r</span><span class="o">.</span><span class="n">n</span><span class="o">+</span><span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">ca</span><span class="o">+</span><span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">c</span><span class="o">+</span><span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">ss</span> <span class="p">)</span>
	<span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">r</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">v</span><span class="p">)</span>
	<span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
		<span class="k">return</span> <span class="s">&quot;n &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;, ca &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">ca</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;, c &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">c</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;, ss &quot;</span><span class="o">+</span><span class="n">r</span><span class="o">.</span><span class="n">ss</span>
<div class="viewcode-block" id="ResBB.stub"><a class="viewcode-back" href="../pymol_util.html#pymol_util.ResBB.stub">[docs]</a>	<span class="k">def</span> <span class="nf">stub</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Xform</span><span class="o">.</span><span class="n">from_four_points</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Xform</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">ca</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">ca</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="DisulfLib"><a class="viewcode-back" href="../pymol_util.html#pymol_util.DisulfLib">[docs]</a><span class="k">class</span> <span class="nc">DisulfLib</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;docstring for DisulfLib&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
		<span class="nb">super</span><span class="p">(</span><span class="n">DisulfLib</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;EE&quot;</span><span class="p">:[],</span> <span class="s">&quot;EH&quot;</span><span class="p">:[],</span> <span class="s">&quot;EL&quot;</span><span class="p">:[],</span> <span class="s">&quot;HE&quot;</span><span class="p">:[],</span> <span class="s">&quot;HH&quot;</span><span class="p">:[],</span> <span class="s">&quot;HL&quot;</span><span class="p">:[],</span> <span class="s">&quot;LE&quot;</span><span class="p">:[],</span> <span class="s">&quot;LH&quot;</span><span class="p">:[],</span> <span class="s">&quot;LL&quot;</span><span class="p">:[]}</span>
		<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
			<span class="n">ss1</span><span class="p">,</span> <span class="n">ss2</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">rt</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">xz</span><span class="p">,</span> <span class="n">yx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">yz</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="p">[</span><span class="n">ss1</span><span class="o">+</span><span class="n">ss2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Jump</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Mat</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">xz</span><span class="p">,</span> <span class="n">yx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">yz</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">zz</span><span class="p">),</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)))</span>

<div class="viewcode-block" id="DisulfLib.disulf_rms"><a class="viewcode-back" href="../pymol_util.html#pymol_util.DisulfLib.disulf_rms">[docs]</a>	<span class="k">def</span> <span class="nf">disulf_rms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">):</span>
		<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span> <span class="ow">is</span> <span class="n">ResBB</span>
		<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span> <span class="ow">is</span> <span class="n">ResBB</span>
		<span class="n">minrms</span> <span class="o">=</span> <span class="mf">9e9</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">ca</span><span class="o">-</span><span class="n">r2</span><span class="o">.</span><span class="n">ca</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span> <span class="k">return</span> <span class="n">minrms</span>
		<span class="n">ss1</span><span class="p">,</span> <span class="n">ss2</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">ss</span><span class="p">,</span> <span class="n">r2</span><span class="o">.</span><span class="n">ss</span>
		<span class="k">if</span> <span class="n">r1</span><span class="o">.</span><span class="n">ss</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s">&quot;HEL&quot;</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="o">.</span><span class="n">ss</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">ss1</span> <span class="o">=</span> <span class="s">&quot;L&quot;</span>
		<span class="k">if</span> <span class="n">r2</span><span class="o">.</span><span class="n">ss</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s">&quot;HEL&quot;</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">ss</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">ss2</span> <span class="o">=</span> <span class="s">&quot;L&quot;</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="p">[</span><span class="n">ss1</span><span class="o">+</span><span class="n">ss2</span><span class="p">][:</span><span class="mi">1</span><span class="p">]:</span>
			<span class="n">s</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">stub</span><span class="p">()</span>
			<span class="n">r1_in_s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>
			<span class="n">r3_in_s</span> <span class="o">=</span> <span class="n">r1_in_s</span> <span class="o">+</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c">#( j.t * r1_in_s ) + j.trans</span>
			<span class="n">r3</span>      <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">r3_in_s</span><span class="p">)</span>
			<span class="n">rms</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">rms</span><span class="p">(</span><span class="n">r3</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">rms</span> <span class="o">&lt;</span> <span class="n">minrms</span><span class="p">:</span> <span class="n">minrms</span> <span class="o">=</span> <span class="n">rms</span>
		<span class="k">return</span> <span class="n">minrms</span>

</div></div>
<div class="viewcode-block" id="chirality"><a class="viewcode-back" href="../pymol_util.html#pymol_util.chirality">[docs]</a><span class="k">def</span> <span class="nf">chirality</span><span class="p">(</span><span class="n">fe1</span><span class="p">,</span> <span class="n">fe2</span><span class="p">,</span> <span class="n">fe3</span><span class="p">,</span> <span class="n">fe4</span><span class="p">):</span>
	<span class="n">a</span> <span class="o">=</span> <span class="n">fe2</span><span class="o">-</span><span class="n">fe1</span>
	<span class="n">b</span> <span class="o">=</span> <span class="n">fe3</span><span class="o">-</span><span class="n">fe1</span>
	<span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">fe4</span><span class="o">-</span><span class="n">fe1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="dimeraxis1"><a class="viewcode-back" href="../pymol_util.html#pymol_util.dimeraxis1">[docs]</a><span class="k">def</span> <span class="nf">dimeraxis1</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">):</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">atom</span><span class="p">):</span>
		<span class="k">print</span> <span class="s">&quot;selections must contain the same number of atoms!&quot;</span>
		<span class="k">return</span>
	<span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">atom</span><span class="p">))</span>
	<span class="k">while</span> <span class="n">j</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span> <span class="n">j</span> <span class="o">=</span> <span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">atom</span><span class="p">))</span>
	<span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">),</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
	<span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
	<span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">),</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
	<span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
	<span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">u</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="n">u</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="dimeraxis"><a class="viewcode-back" href="../pymol_util.html#pymol_util.dimeraxis">[docs]</a><span class="k">def</span> <span class="nf">dimeraxis</span><span class="p">(</span><span class="n">sel1</span><span class="p">,</span> <span class="n">sel2</span><span class="p">,</span> <span class="n">nsamp</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
	<span class="n">m1</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel1</span><span class="p">)</span>
	<span class="n">m2</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel2</span><span class="p">)</span>
	<span class="n">a</span><span class="p">,</span> <span class="n">wtot</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nsamp</span><span class="p">)):</span>
		<span class="n">u</span> <span class="o">=</span> <span class="n">dimeraxis1</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span>
		<span class="c"># print u</span>
		<span class="n">a</span>  <span class="o">+=</span> <span class="n">u</span>
		<span class="n">wtot</span> <span class="o">+=</span> <span class="n">u</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
	<span class="n">a</span> <span class="o">/=</span> <span class="n">wtot</span>
	<span class="k">return</span> <span class="n">a</span>

</div>
<div class="viewcode-block" id="axisofrot1"><a class="viewcode-back" href="../pymol_util.html#pymol_util.axisofrot1">[docs]</a><span class="k">def</span> <span class="nf">axisofrot1</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">m3</span><span class="p">):</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m3</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">m3</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">atom</span><span class="p">):</span>
		<span class="k">print</span> <span class="s">&quot;selections must contain the same number of atoms!&quot;</span>
		<span class="k">return</span>
	<span class="n">i</span> <span class="o">=</span> <span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">atom</span><span class="p">))</span>
	<span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">),</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">),</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m3</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
	<span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="o">+</span><span class="n">a3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
	<span class="n">i</span> <span class="o">=</span> <span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">atom</span><span class="p">))</span>
	<span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">),</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">),</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m3</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
	<span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span><span class="o">+</span><span class="n">a2</span><span class="o">+</span><span class="n">a3</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span>
	<span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">v</span><span class="o">.</span><span class="n">length</span><span class="p">():</span>
		<span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">,</span> <span class="n">u</span>
	<span class="k">return</span> <span class="n">v</span><span class="o">-</span><span class="n">u</span>

</div>
<div class="viewcode-block" id="axisofrot"><a class="viewcode-back" href="../pymol_util.html#pymol_util.axisofrot">[docs]</a><span class="k">def</span> <span class="nf">axisofrot</span><span class="p">(</span><span class="n">sel1</span><span class="p">,</span> <span class="n">sel2</span><span class="p">,</span> <span class="n">sel3</span><span class="p">,</span> <span class="n">nsamp</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
	<span class="n">m1</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel1</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">m2</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel2</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">m3</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel3</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="n">m1</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
	<span class="n">m2</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
	<span class="n">m3</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m3</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
	<span class="k">return</span> <span class="p">((</span><span class="n">m2</span><span class="o">-</span><span class="n">m1</span><span class="p">)</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">m2</span><span class="o">-</span><span class="n">m3</span><span class="p">))</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="c"># a, wtot = xyz.Vec(0), 0</span>
	<span class="c"># for i in range(int(nsamp)):</span>
	<span class="c">#    u = axisofrot1(m1, m2, m3)</span>
	<span class="c">#    a  += u</span>
	<span class="c">#    wtot += u.length()</span>
	<span class="c"># a /= wtot</span>
	<span class="k">return</span> <span class="n">a</span>

<span class="c">#   0.373875069479 0.733798169028 0.567236881341 24.7756576007</span>
</div>
<div class="viewcode-block" id="bond_zns"><a class="viewcode-back" href="../pymol_util.html#pymol_util.bond_zns">[docs]</a><span class="k">def</span> <span class="nf">bond_zns</span><span class="p">(</span><span class="n">sel</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">unbond</span><span class="p">(</span><span class="n">sel</span> <span class="o">+</span> <span class="s">&quot; and resn ZNS&quot;</span><span class="p">,</span> <span class="n">sel</span> <span class="o">+</span> <span class="s">&quot; and not resn ZNS&quot;</span><span class="p">)</span>
	<span class="c"># for c, i in getres(&quot;resn ZNS&quot;):</span>
	<span class="c">#    cmd.bond(sel+&quot; and chain %s and resi %i and name ZN1&quot;%(c, i),</span>
	<span class="c">#             sel+&quot; and chain %s and resi %i and name S*&quot;%(c, i))</span>
	<span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">getres</span><span class="p">(</span><span class="s">&quot;name ZN1&quot;</span><span class="p">):</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">bond</span><span class="p">(</span><span class="n">sel</span> <span class="o">+</span> <span class="s">&quot; and chain </span><span class="si">%s</span><span class="s"> and resi </span><span class="si">%i</span><span class="s"> and name ZN1&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
					<span class="n">sel</span> <span class="o">+</span> <span class="s">&quot; and chain </span><span class="si">%s</span><span class="s"> and resi </span><span class="si">%i</span><span class="s"> and name S*, N2, N4&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
	<span class="n">allsg</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span> <span class="o">+</span> <span class="s">&quot; and (resn CYS and (name CB))&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span>
	<span class="n">allsf</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span> <span class="o">+</span> <span class="s">&quot; and (resn ZHC and (name S*, C1, C4))&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span>
	<span class="k">while</span> <span class="n">allsg</span><span class="p">:</span>
		<span class="n">closest</span> <span class="o">=</span> <span class="p">[</span><span class="mf">9e9</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">sga</span> <span class="ow">in</span> <span class="n">allsg</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">sfa</span> <span class="ow">in</span> <span class="n">allsf</span><span class="p">:</span>
				<span class="n">sg</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">sga</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
				<span class="n">sf</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">sfa</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">sg</span> <span class="o">-</span> <span class="n">sf</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">closest</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
					<span class="n">closest</span> <span class="o">=</span> <span class="p">[(</span><span class="n">sg</span><span class="o">-</span><span class="n">sf</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">(),</span> <span class="n">sga</span><span class="p">,</span> <span class="n">sfa</span><span class="p">]</span>
		<span class="n">sga</span><span class="p">,</span> <span class="n">sfa</span> <span class="o">=</span> <span class="n">closest</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
		<span class="n">allsg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sga</span><span class="p">)</span>
		<span class="n">allsf</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sfa</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">closest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">10.0</span><span class="p">:</span> <span class="k">break</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">bond</span><span class="p">(</span><span class="n">sel</span><span class="o">+</span><span class="s">&quot; and resi </span><span class="si">%s</span><span class="s"> and chain </span><span class="si">%s</span><span class="s"> and name </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sga</span><span class="o">.</span><span class="n">resi</span><span class="p">,</span> <span class="n">sga</span><span class="o">.</span><span class="n">chain</span><span class="p">,</span> <span class="n">sga</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>

					<span class="n">sel</span><span class="o">+</span><span class="s">&quot; and resi </span><span class="si">%s</span><span class="s"> and chain </span><span class="si">%s</span><span class="s"> and name </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sfa</span><span class="o">.</span><span class="n">resi</span><span class="p">,</span> <span class="n">sfa</span><span class="o">.</span><span class="n">chain</span><span class="p">,</span> <span class="n">sfa</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="p">)</span>

</div>
<div class="viewcode-block" id="trans"><a class="viewcode-back" href="../pymol_util.html#pymol_util.trans">[docs]</a><span class="k">def</span> <span class="nf">trans</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
	<span class="k">if</span>   <span class="n">xyz</span><span class="o">.</span><span class="n">isvec</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="n">cmd</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">],</span> <span class="n">sel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isnum</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="n">cmd</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span> <span class="n">v</span> <span class="p">,</span> <span class="n">v</span> <span class="p">,</span> <span class="n">v</span> <span class="p">],</span> <span class="n">sel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<div class="viewcode-block" id="transx"><a class="viewcode-back" href="../pymol_util.html#pymol_util.transx">[docs]</a><span class="k">def</span> <span class="nf">transx</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isnum</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="n">cmd</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">sel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<div class="viewcode-block" id="transy"><a class="viewcode-back" href="../pymol_util.html#pymol_util.transy">[docs]</a><span class="k">def</span> <span class="nf">transy</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isnum</span><span class="p">(</span><span class="n">y</span><span class="p">):</span> <span class="n">cmd</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">sel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<div class="viewcode-block" id="transz"><a class="viewcode-back" href="../pymol_util.html#pymol_util.transz">[docs]</a><span class="k">def</span> <span class="nf">transz</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isnum</span><span class="p">(</span><span class="n">z</span><span class="p">):</span> <span class="n">cmd</span><span class="o">.</span><span class="n">translate</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">z</span><span class="p">],</span> <span class="n">sel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="rot"><a class="viewcode-back" href="../pymol_util.html#pymol_util.rot">[docs]</a><span class="k">def</span> <span class="nf">rot</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">cen</span><span class="o">=</span><span class="n">xyz</span><span class="o">.</span><span class="n">V0</span><span class="p">):</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isvec</span><span class="p">(</span><span class="n">axis</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isnum</span><span class="p">(</span><span class="n">ang</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isvec</span><span class="p">(</span><span class="n">cen</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>	
	<span class="c"># if abs(axis.x) &lt; 0.00001: axis.x = 0.0</span>
	<span class="c"># if abs(axis.y) &lt; 0.00001: axis.y = 0.0</span>
	<span class="c"># if abs(axis.z) &lt; 0.00001: axis.z = 0.0</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">rotate</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="mi">6</span><span class="p">)],</span> <span class="n">ang</span><span class="p">,</span> <span class="n">sel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="n">cen</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cen</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cen</span><span class="o">.</span><span class="n">z</span><span class="p">])</span></div>
<div class="viewcode-block" id="rotx"><a class="viewcode-back" href="../pymol_util.html#pymol_util.rotx">[docs]</a><span class="k">def</span> <span class="nf">rotx</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">cen</span><span class="o">=</span><span class="n">xyz</span><span class="o">.</span><span class="n">V0</span><span class="p">):</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isnum</span><span class="p">(</span><span class="n">ang</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isvec</span><span class="p">(</span><span class="n">cen</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>	
	<span class="n">cmd</span><span class="o">.</span><span class="n">rotate</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">ang</span><span class="p">,</span> <span class="n">sel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="n">cen</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cen</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cen</span><span class="o">.</span><span class="n">z</span><span class="p">])</span></div>
<div class="viewcode-block" id="roty"><a class="viewcode-back" href="../pymol_util.html#pymol_util.roty">[docs]</a><span class="k">def</span> <span class="nf">roty</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">cen</span><span class="o">=</span><span class="n">xyz</span><span class="o">.</span><span class="n">V0</span><span class="p">):</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isnum</span><span class="p">(</span><span class="n">ang</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isvec</span><span class="p">(</span><span class="n">cen</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>	
	<span class="n">cmd</span><span class="o">.</span><span class="n">rotate</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">ang</span><span class="p">,</span> <span class="n">sel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="n">cen</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cen</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cen</span><span class="o">.</span><span class="n">z</span><span class="p">])</span></div>
<div class="viewcode-block" id="rotz"><a class="viewcode-back" href="../pymol_util.html#pymol_util.rotz">[docs]</a><span class="k">def</span> <span class="nf">rotz</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">cen</span><span class="o">=</span><span class="n">xyz</span><span class="o">.</span><span class="n">V0</span><span class="p">):</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isnum</span><span class="p">(</span><span class="n">ang</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isvec</span><span class="p">(</span><span class="n">cen</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>	
	<span class="n">cmd</span><span class="o">.</span><span class="n">rotate</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">ang</span><span class="p">,</span> <span class="n">sel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="n">cen</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cen</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cen</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="xform"><a class="viewcode-back" href="../pymol_util.html#pymol_util.xform">[docs]</a><span class="k">def</span> <span class="nf">xform</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">xyz</span><span class="o">.</span><span class="n">isxform</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span>
	<span class="n">axis</span><span class="p">,</span><span class="n">ang</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rotation_axis</span><span class="p">()</span>
	<span class="n">rot</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span><span class="n">axis</span><span class="p">,</span><span class="n">xyz</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">ang</span><span class="p">))</span>
	<span class="n">trans</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
	<span class="c"># a,r,c = x.rotation_center()</span>
	<span class="c"># cmd.rotate([a.x,a.y,a.z], r, sel, 0, 0, None, [c.x, c.y, c.z])</span>
</div>
<div class="viewcode-block" id="rot_by_matrix"><a class="viewcode-back" href="../pymol_util.html#pymol_util.rot_by_matrix">[docs]</a><span class="k">def</span> <span class="nf">rot_by_matrix</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">cen</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
  <span class="n">m</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">)):</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span> <span class="n">R</span> <span class="o">*</span> <span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span><span class="o">-</span><span class="n">cen</span><span class="p">)</span> <span class="p">)</span> <span class="o">+</span> <span class="n">cen</span>
		<span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tmp</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tmp</span><span class="o">.</span><span class="n">z</span><span class="p">]</span>
  <span class="n">cmd</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">sel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">discrete</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="rotrad"><a class="viewcode-back" href="../pymol_util.html#pymol_util.rotrad">[docs]</a><span class="k">def</span> <span class="nf">rotrad</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">cen</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">rot</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">ang</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">cen</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="pointaxis"><a class="viewcode-back" href="../pymol_util.html#pymol_util.pointaxis">[docs]</a><span class="k">def</span> <span class="nf">pointaxis</span><span class="p">(</span><span class="n">sel</span><span class="p">):</span>
	<span class="n">u</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="n">m</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
	<span class="n">c</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
	<span class="n">axis</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">:</span>
		<span class="n">v</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span><span class="o">-</span><span class="n">c</span>
		<span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span>
		<span class="n">axis</span> <span class="o">+=</span> <span class="n">v</span>
	<span class="k">return</span> <span class="n">axis</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="alignaxis"><a class="viewcode-back" href="../pymol_util.html#pymol_util.alignaxis">[docs]</a><span class="k">def</span> <span class="nf">alignaxis</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">newaxis</span><span class="p">,</span> <span class="n">oldaxis</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">cen</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
	<span class="k">if</span> <span class="n">oldaxis</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">oldaxis</span> <span class="o">=</span> <span class="n">pointaxis</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">cen</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">cen</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
	<span class="n">newaxis</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
	<span class="n">oldaxis</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
	<span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">oldaxis</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">newaxis</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.99999</span><span class="p">:</span> <span class="k">return</span>
	<span class="n">axis</span> <span class="o">=</span> <span class="n">newaxis</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">oldaxis</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="n">ang</span>  <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">newaxis</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">oldaxis</span><span class="p">))))</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
	<span class="c"># print &quot;rot around&quot;, axis, &quot;by&quot;, ang</span>
	<span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;nan&quot;</span><span class="p">:</span> <span class="k">return</span>
	<span class="n">rot</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">cen</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">axis</span><span class="p">,</span> <span class="n">ang</span>

<span class="c"># def showvec(x, y, z, l = 100, c = None):</span>
<span class="c">#    if c is None: c = com(&quot;all&quot;)</span>
<span class="c">#    v = xyz.Vec(x, y, z).normalized()</span>
<span class="c">#    a1 = c + v*l/2</span>
<span class="c">#    a2 = c - v*l/2</span>
<span class="c">#    obj = [</span>
<span class="c">#          BEGIN, LINES,</span>
<span class="c">#          COLOR, 1.0, 1.0, 1.0,</span>
<span class="c">#          VERTEX, a1.x, a1.y, a1.z,</span>
<span class="c">#          VERTEX, a2.x, a2.y, a2.z,</span>
<span class="c">#          END</span>
<span class="c">#    ]</span>
<span class="c">#    cmd.load_cgo(obj, &#39;vec&#39;)</span>
<span class="c">#</span>

</div>
<div class="viewcode-block" id="mysetview"><a class="viewcode-back" href="../pymol_util.html#pymol_util.mysetview">[docs]</a><span class="k">def</span> <span class="nf">mysetview</span><span class="p">(</span><span class="n">look</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">cen</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">ncp</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">fcp</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
	<span class="n">Xaxis</span> <span class="o">=</span> <span class="o">-</span><span class="n">look</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">up</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="n">Yaxis</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">projperp</span><span class="p">(</span><span class="n">look</span><span class="p">,</span> <span class="n">up</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="n">Zaxis</span> <span class="o">=</span> <span class="o">-</span><span class="n">look</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="n">oldv</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
	<span class="n">v</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">oldv</span><span class="p">)</span>
	<span class="n">r</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Mat</span><span class="p">(</span><span class="n">Xaxis</span><span class="p">,</span> <span class="n">Yaxis</span><span class="p">,</span> <span class="n">Zaxis</span><span class="p">)</span>
	<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">xx</span><span class="p">;</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">xy</span><span class="p">;</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">xz</span>
	<span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">yx</span><span class="p">;</span> <span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">yy</span><span class="p">;</span> <span class="n">v</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">yz</span>
	<span class="n">v</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">zx</span><span class="p">;</span> <span class="n">v</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">zy</span><span class="p">;</span> <span class="n">v</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">zz</span>
	<span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span> <span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">pos</span><span class="o">.</span><span class="n">z</span>
	<span class="k">if</span> <span class="n">cen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="n">cen</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cen</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cen</span><span class="o">.</span><span class="n">z</span>
	<span class="k">if</span> <span class="n">ncp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>    <span class="o">=</span> <span class="n">ncp</span>
	<span class="k">if</span> <span class="n">fcp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>    <span class="o">=</span> <span class="n">fcp</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">Yaxis</span>
</div>
<div class="viewcode-block" id="meancoords"><a class="viewcode-back" href="../pymol_util.html#pymol_util.meancoords">[docs]</a><span class="k">def</span> <span class="nf">meancoords</span><span class="p">(</span><span class="n">sel1</span><span class="p">,</span> <span class="n">sel2</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="s">&quot;mix&quot;</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel1</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">]</span>
	<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel2</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">]</span>
	<span class="n">d</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))]</span>
	<span class="c">#print max(d), argmax(d), cmd.get_model(&quot;179L&quot;).atom[argmax(d)].resi</span>
	<span class="c">#print min(d)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sel1</span><span class="p">)</span>
	<span class="n">m</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel1</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">)):</span>
		<span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">w</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
		<span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">w</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>
		<span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">w</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">z</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="mygetview"><a class="viewcode-back" href="../pymol_util.html#pymol_util.mygetview">[docs]</a><span class="k">def</span> <span class="nf">mygetview</span><span class="p">():</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="swell"><a class="viewcode-back" href="../pymol_util.html#pymol_util.swell">[docs]</a><span class="k">def</span> <span class="nf">swell</span><span class="p">():</span>
	<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s">&quot;177L&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">]</span>
	<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s">&quot;179L&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">]</span>
	<span class="n">d</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">length</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))]</span>
	<span class="c">#print max(d), argmax(d), cmd.get_model(&quot;179L&quot;).atom[argmax(d)].resi</span>
	<span class="c">#print min(d)</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">):</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;mix</span><span class="si">%03i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="s">&quot;177L&quot;</span><span class="p">)</span>
		<span class="n">m</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s">&quot;177L&quot;</span><span class="p">)</span>
		<span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="mf">100.0</span>
		<span class="k">print</span> <span class="s">&quot;mixing&quot;</span><span class="p">,</span> <span class="n">r</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">)):</span>
			<span class="c"># for k in range(len(m.atom)):</span>
			<span class="c">#   d = (a[j]-a[k]).length() - (b[j]-b[k]).length()</span>
			<span class="c"># print j, m.atom[j].coord</span>
			<span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
			<span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>
			<span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">b</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">z</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">z</span>
			<span class="c"># print j, m.atom[j].coord</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;mix</span><span class="si">%03i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&quot;177L_179L_raw_mix</span><span class="si">%03i</span><span class="s">.pdb&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="s">&quot;mix</span><span class="si">%03i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="mkhelix"><a class="viewcode-back" href="../pymol_util.html#pymol_util.mkhelix">[docs]</a><span class="k">def</span> <span class="nf">mkhelix</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;h</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;h</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
		<span class="n">rot</span>  <span class="p">(</span><span class="s">&quot;h</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">i</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
		<span class="n">trans</span><span class="p">(</span><span class="s">&quot;h</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="mkhelix4"><a class="viewcode-back" href="../pymol_util.html#pymol_util.mkhelix4">[docs]</a><span class="k">def</span> <span class="nf">mkhelix4</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;h</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;h</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
		<span class="n">rt</span> <span class="o">=</span> <span class="mf">90.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">4</span><span class="p">)</span>
		<span class="k">print</span> <span class="n">i</span><span class="p">,</span> <span class="n">rt</span>
		<span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">4</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;hem</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="s">&quot;basehem&quot;</span><span class="p">)</span>
			<span class="n">trans</span><span class="p">(</span><span class="s">&quot;hem</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">*</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">4</span><span class="p">))))</span>
			<span class="n">rot</span>  <span class="p">(</span><span class="s">&quot;hem</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">4</span><span class="p">)),</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
			<span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">52</span><span class="p">):</span>
				<span class="n">rot</span>  <span class="p">(</span><span class="s">&quot;hem</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">90</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
		<span class="n">rot</span>  <span class="p">(</span><span class="s">&quot;h</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rt</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
		<span class="n">trans</span><span class="p">(</span><span class="s">&quot;h</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">*</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">4</span><span class="p">))))</span>
		<span class="n">rot</span>  <span class="p">(</span><span class="s">&quot;h</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">4</span><span class="p">)),</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="s">&quot;ev&quot;</span><span class="p">,</span> <span class="s">&quot;not (name N, CA, C, O, CB) and (h1, h3, h4, h6, h9, h11, h12, h14, h17, h19, h20, h22, h25, h27)&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="s">&quot;ev&quot;</span><span class="p">,</span> <span class="s">&quot;name SG and not (h0, h5, h8, h13, h16, h21, h24, h29, h32, h37, h40, h45, h48, base)&quot;</span><span class="p">)</span>
<span class="c">#PyMOL&gt;run /Users/sheffler/pymol_scripts/util.py; mkhelix4(&quot;4hel* and vis&quot;, 10.2, -23.9, 12)</span>

</div>
<div class="viewcode-block" id="mirror"><a class="viewcode-back" href="../pymol_util.html#pymol_util.mirror">[docs]</a><span class="k">def</span> <span class="nf">mirror</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">nname</span> <span class="o">=</span> <span class="s">&quot;mirror&quot;</span><span class="p">,</span> <span class="n">crd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">nname</span><span class="p">)</span>
	<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">]</span>
	<span class="c">#print max(d), argmax(d), cmd.get_model(&quot;179L&quot;).atom[argmax(d)].resi</span>
	<span class="c">#print min(d)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">nname</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">m</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">)):</span>
		<span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="n">crd</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nname</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="inversion"><a class="viewcode-back" href="../pymol_util.html#pymol_util.inversion">[docs]</a><span class="k">def</span> <span class="nf">inversion</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">nname</span> <span class="o">=</span> <span class="s">&quot;inv&quot;</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">nname</span><span class="p">)</span>
	<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">]</span>
	<span class="c">#print max(d), argmax(d), cmd.get_model(&quot;179L&quot;).atom[argmax(d)].resi</span>
	<span class="c">#print min(d)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">nname</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">m</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">)):</span>
		<span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nname</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="mkc4"><a class="viewcode-back" href="../pymol_util.html#pymol_util.mkc4">[docs]</a><span class="k">def</span> <span class="nf">mkc4</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;c1&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;c2&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;c3&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;c4&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;c1&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;c2&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;c3&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;c4&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;c2&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;c3&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;c4&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="mkc3"><a class="viewcode-back" href="../pymol_util.html#pymol_util.mkc3">[docs]</a><span class="k">def</span> <span class="nf">mkc3</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;c1&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;c2&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;c3&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;c1&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;c2&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;c3&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;c2&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;c3&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&#39;c1&#39;</span><span class="p">,</span> <span class="s">&#39;chain = &quot;A&quot;&#39;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&#39;c2&#39;</span><span class="p">,</span> <span class="s">&#39;chain = &quot;B&quot;&#39;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&#39;c3&#39;</span><span class="p">,</span> <span class="s">&#39;chain = &quot;C&quot;&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="mkc2"><a class="viewcode-back" href="../pymol_util.html#pymol_util.mkc2">[docs]</a><span class="k">def</span> <span class="nf">mkc2</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">c</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;c1&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;c2&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;c1&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;c2&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;c2&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&#39;c1&#39;</span><span class="p">,</span> <span class="s">&#39;chain = &quot;A&quot;&#39;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&#39;c2&#39;</span><span class="p">,</span> <span class="s">&#39;chain = &quot;B&quot;&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="mkd2"><a class="viewcode-back" href="../pymol_util.html#pymol_util.mkd2">[docs]</a><span class="k">def</span> <span class="nf">mkd2</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">Ux</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="n">Uy</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="n">Uz</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="s">&#39;chain = &quot;A&quot;&#39;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;chain = &quot;B&quot;&#39;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;chain = &quot;C&quot;&#39;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="s">&#39;chain = &quot;D&quot;&#39;</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="alignall"><a class="viewcode-back" href="../pymol_util.html#pymol_util.alignall">[docs]</a><span class="k">def</span> <span class="nf">alignall</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">obj</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
	<span class="n">l</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">()</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">obj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;ERROR object&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="s">&quot;not found!!!&quot;</span>
		<span class="k">return</span>
	<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="n">obj</span><span class="p">:</span> <span class="k">continue</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="s">&quot;align &quot;</span><span class="o">+</span><span class="n">o</span><span class="o">+</span><span class="s">&quot; and (&quot;</span><span class="o">+</span><span class="n">sel</span><span class="o">+</span><span class="s">&quot;), &quot;</span><span class="o">+</span><span class="n">obj</span><span class="o">+</span><span class="s">&quot; and (&quot;</span><span class="o">+</span><span class="n">sel</span><span class="o">+</span><span class="s">&quot;)&quot;</span><span class="p">)</span>
	<span class="k">return</span>
</div>
<div class="viewcode-block" id="centerall"><a class="viewcode-back" href="../pymol_util.html#pymol_util.centerall">[docs]</a><span class="k">def</span> <span class="nf">centerall</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">):</span>
	<span class="n">l</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
		<span class="n">s</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> and (</span><span class="si">%s</span><span class="s">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
		<span class="n">trans</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="n">com</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
	<span class="k">return</span>

</div>
<div class="viewcode-block" id="showcst"><a class="viewcode-back" href="../pymol_util.html#pymol_util.showcst">[docs]</a><span class="k">def</span> <span class="nf">showcst</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
		<span class="n">kind</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span>
		<span class="n">a1</span> <span class="o">=</span> <span class="s">&quot;(resi </span><span class="si">%s</span><span class="s"> and name </span><span class="si">%s</span><span class="s">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span>
		<span class="n">a2</span> <span class="o">=</span> <span class="s">&quot;(resi </span><span class="si">%s</span><span class="s"> and name </span><span class="si">%s</span><span class="s">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">bond</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&quot;lines&quot;</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&quot;lines&quot;</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="bondzn"><a class="viewcode-back" href="../pymol_util.html#pymol_util.bondzn">[docs]</a><span class="k">def</span> <span class="nf">bondzn</span><span class="p">():</span>
	<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">():</span>
		<span class="k">print</span> <span class="s">&quot;add zn bonds for&quot;</span><span class="p">,</span> <span class="n">o</span>
		<span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">getres</span><span class="p">(</span><span class="n">o</span><span class="o">+</span><span class="s">&quot; and elem ZN&quot;</span><span class="p">):</span>
			<span class="n">cmd</span><span class="o">.</span><span class="n">bond</span><span class="p">(</span><span class="s">&quot;(</span><span class="si">%s</span><span class="s"> and resi </span><span class="si">%s</span><span class="s"> and chain </span><span class="si">%s</span><span class="s">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="s">&quot;(</span><span class="si">%s</span><span class="s"> and resn HIS and elem N) within 2.5 of (</span><span class="si">%s</span><span class="s"> and resi </span><span class="si">%s</span><span class="s"> and chain </span><span class="si">%s</span><span class="s">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">)</span>
		<span class="k">break</span>
</div>
<div class="viewcode-block" id="loadmov"><a class="viewcode-back" href="../pymol_util.html#pymol_util.loadmov">[docs]</a><span class="k">def</span> <span class="nf">loadmov</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
	<span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">d</span><span class="o">+</span><span class="s">&quot;/*.pdb&quot;</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span> <span class="n">cmd</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;mov&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="drawlines"><a class="viewcode-back" href="../pymol_util.html#pymol_util.drawlines">[docs]</a><span class="k">def</span> <span class="nf">drawlines</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">lab</span> <span class="o">=</span> <span class="s">&quot;lines&quot;</span><span class="p">,</span> <span class="n">COL</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="mf">20.0</span><span class="p">):</span>
	<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="p">]</span>
	<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span> <span class="n">d</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="p">]</span>
	<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
	<span class="n">obj</span> <span class="o">=</span> <span class="p">[</span> <span class="n">BEGIN</span><span class="p">,</span> <span class="n">LINES</span><span class="p">,</span> <span class="n">COLOR</span><span class="p">,</span> <span class="n">COL</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">COL</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">COL</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
		<span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="o">-</span><span class="n">SIZE</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span>  <span class="n">SIZE</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
				<span class="n">VERTEX</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p1</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
				<span class="n">VERTEX</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">p2</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
			<span class="p">])</span>
	<span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">END</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">lab</span><span class="p">)</span>


<span class="c">################### disulf cone tests ##################################</span>
</div>
<div class="viewcode-block" id="drawtestconeva"><a class="viewcode-back" href="../pymol_util.html#pymol_util.drawtestconeva">[docs]</a><span class="k">def</span> <span class="nf">drawtestconeva</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;cone hyperb&quot;</span><span class="p">)</span>
	<span class="c"># v = com(sele+&quot; and name SG&quot;)</span>
	<span class="c"># a = (v - com(sele+&quot; and name CB&quot;)).normalized()</span>
	<span class="c"># print v, a</span>
	<span class="n">ang</span> <span class="o">=</span> <span class="mf">5.0</span>
	<span class="n">R</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">rotation_matrix_degrees</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ang</span><span class="p">)</span>
	<span class="n">perp</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">randvec</span><span class="p">())</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">perp</span>
	<span class="n">d</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">rotation_matrix_degrees</span><span class="p">(</span><span class="n">perp</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span><span class="o">*</span><span class="n">a</span>
	<span class="n">P</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">360</span><span class="o">/</span><span class="n">ang</span><span class="p">)):</span>
		<span class="n">P</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
		<span class="n">D</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">R</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span>
		<span class="n">d</span> <span class="o">=</span> <span class="n">R</span><span class="o">*</span><span class="n">d</span>
	<span class="n">drawlines</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="s">&quot;hyperb&quot;</span><span class="p">,</span> <span class="n">COL</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">v</span>
	<span class="n">d</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">rotation_matrix_degrees</span><span class="p">(</span> <span class="n">a</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">randvec</span><span class="p">()),</span> <span class="mi">45</span> <span class="p">)</span> <span class="o">*</span><span class="n">a</span>
	<span class="n">P</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">360</span><span class="o">/</span><span class="n">ang</span><span class="p">):</span>
		<span class="n">P</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
		<span class="n">D</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
		<span class="n">d</span> <span class="o">=</span> <span class="n">R</span><span class="o">*</span><span class="n">d</span>
	<span class="n">drawlines</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="s">&quot;cone&quot;</span><span class="p">,</span> <span class="n">COL</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="conelineinter"><a class="viewcode-back" href="../pymol_util.html#pymol_util.conelineinter">[docs]</a><span class="k">def</span> <span class="nf">conelineinter</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
	<span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
	<span class="n">xyz</span><span class="o">.</span><span class="n">Mat</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">xyz</span><span class="o">.</span><span class="n">Mat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="n">D</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="n">v</span>
	<span class="n">c2</span> <span class="o">=</span>   <span class="n">d</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Mat</span><span class="o">*</span><span class="n">d</span><span class="p">)</span>
	<span class="n">c1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Mat</span><span class="o">*</span><span class="n">D</span><span class="p">)</span>
	<span class="n">c0</span> <span class="o">=</span>   <span class="n">D</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Mat</span><span class="o">*</span><span class="n">D</span><span class="p">)</span>
	<span class="n">disc</span> <span class="o">=</span> <span class="n">c1</span><span class="o">*</span><span class="n">c1</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">c0</span><span class="o">*</span><span class="n">c2</span>
	<span class="k">if</span> <span class="n">disc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="p">()</span>
	<span class="k">if</span> <span class="n">disc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="p">(</span> <span class="n">p</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">c1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">c2</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="p">)</span>
	<span class="n">disc</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">disc</span><span class="p">)</span>
	<span class="k">return</span> <span class="p">(</span> <span class="n">p</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">c1</span><span class="o">+</span><span class="n">disc</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">c2</span><span class="p">)</span><span class="o">*</span><span class="n">d</span> <span class="p">,</span> <span class="n">p</span><span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">c1</span><span class="o">-</span><span class="n">disc</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">c2</span><span class="p">)</span><span class="o">*</span><span class="n">d</span> <span class="p">)</span>

</div>
<div class="viewcode-block" id="createpoint"><a class="viewcode-back" href="../pymol_util.html#pymol_util.createpoint">[docs]</a><span class="k">def</span> <span class="nf">createpoint</span><span class="p">(</span><span class="n">sele</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">lab</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">sele</span><span class="o">+</span><span class="s">&quot; and name CA&quot;</span><span class="p">)</span>
	<span class="n">trans</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">p</span><span class="o">-</span><span class="n">com</span><span class="p">(</span><span class="n">lab</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="test_conelineinter"><a class="viewcode-back" href="../pymol_util.html#pymol_util.test_conelineinter">[docs]</a><span class="k">def</span> <span class="nf">test_conelineinter</span><span class="p">(</span><span class="n">sele</span><span class="p">):</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="n">sele</span><span class="o">+</span><span class="s">&quot; and name SG&quot;</span><span class="p">)</span>
	<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">com</span><span class="p">(</span><span class="n">sele</span><span class="o">+</span><span class="s">&quot; and name CB&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="k">print</span> <span class="n">v</span><span class="p">,</span> <span class="n">a</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">v</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">randvec</span><span class="p">()</span>
	<span class="n">d</span> <span class="o">=</span> <span class="n">randvec</span><span class="p">()</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="c"># v = xyz.Vec(0, 0, 0)</span>
	<span class="c"># a = xyz.Vec(1, 0, 0)</span>
	<span class="n">t</span> <span class="o">=</span> <span class="mi">45</span>
	<span class="n">Ux</span> <span class="o">=</span> <span class="n">conelineinter</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
	<span class="k">print</span> <span class="s">&quot;p&quot;</span><span class="p">,</span> <span class="n">p</span>
	<span class="k">print</span> <span class="s">&quot;d&quot;</span><span class="p">,</span> <span class="n">d</span>
	<span class="k">print</span> <span class="s">&quot;v&quot;</span><span class="p">,</span> <span class="n">v</span>
	<span class="k">print</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">a</span>
	<span class="k">print</span> <span class="s">&quot;t&quot;</span><span class="p">,</span> <span class="n">t</span>
	<span class="k">print</span> <span class="s">&quot;Ux&quot;</span><span class="p">,</span> <span class="n">Ux</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;lines&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;Ux*&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;L*&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;A*&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;B*&quot;</span><span class="p">)</span>
	<span class="n">drawlines</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Ux</span><span class="p">):</span>
		<span class="n">createpoint</span><span class="p">(</span><span class="n">sele</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s">&quot;Ux&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
		<span class="n">o</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">projperp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="n">v</span><span class="p">)</span>
		<span class="n">L</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
		<span class="n">o</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
		<span class="n">ang</span> <span class="o">=</span> <span class="mf">90.0</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">L</span> <span class="p">)</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
		<span class="k">print</span> <span class="n">ang</span>
		<span class="n">o1</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">rotation_matrix_degrees</span><span class="p">(</span><span class="n">a</span><span class="p">,</span>  <span class="n">ang</span> <span class="p">)</span><span class="o">*</span><span class="n">o</span>
		<span class="n">o2</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">rotation_matrix_degrees</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">ang</span> <span class="p">)</span><span class="o">*</span><span class="n">o</span>
		<span class="n">createpoint</span><span class="p">(</span><span class="n">sele</span><span class="p">,</span> <span class="n">v</span><span class="o">+</span><span class="n">o1</span><span class="p">,</span> <span class="s">&quot;A&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
		<span class="n">createpoint</span><span class="p">(</span><span class="n">sele</span><span class="p">,</span> <span class="n">v</span><span class="o">+</span><span class="n">o2</span><span class="p">,</span> <span class="s">&quot;B&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
		<span class="n">drawlines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="p">(</span><span class="n">v</span><span class="o">+</span><span class="n">o1</span><span class="p">))</span><span class="o">.</span><span class="n">normalized</span><span class="p">(),</span> <span class="s">&quot;xyzMath&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
		<span class="n">drawlines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="p">(</span><span class="n">v</span><span class="o">+</span><span class="n">o2</span><span class="p">))</span><span class="o">.</span><span class="n">normalized</span><span class="p">(),</span> <span class="s">&quot;LB&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>


<span class="c">######################### rosettaholes stuff ###################</span>
</div>
<div class="viewcode-block" id="useRosettaRadii"><a class="viewcode-back" href="../pymol_util.html#pymol_util.useRosettaRadii">[docs]</a><span class="k">def</span> <span class="nf">useRosettaRadii</span><span class="p">():</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;element C&quot;</span><span class="p">,</span> <span class="s">&quot;vdw = 2.00&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;element N&quot;</span><span class="p">,</span> <span class="s">&quot;vdw = 1.75&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;element O&quot;</span><span class="p">,</span> <span class="s">&quot;vdw = 1.55&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;element H&quot;</span><span class="p">,</span> <span class="s">&quot;vdw = 1.00&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;element P&quot;</span><span class="p">,</span> <span class="s">&quot;vdw = 2.15&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;element S&quot;</span><span class="p">,</span> <span class="s">&quot;vdw = 1.90&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;element RE&quot;</span><span class="p">,</span> <span class="s">&quot;vdw = 1.40&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;element CU&quot;</span><span class="p">,</span> <span class="s">&quot;vdw = 1.40&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;sphere_scale&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="expandRadii"><a class="viewcode-back" href="../pymol_util.html#pymol_util.expandRadii">[docs]</a><span class="k">def</span> <span class="nf">expandRadii</span><span class="p">(</span><span class="n">delta</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">sel</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">:</span>
		<span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">vdw</span><span class="p">)</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;index &quot;</span><span class="o">+</span><span class="sb">`a.index`</span><span class="p">,</span> <span class="s">&#39;vdw = &#39;</span><span class="o">+</span><span class="sb">`r`</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">rebuild</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="s">&quot;spheres&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="contractRadii"><a class="viewcode-back" href="../pymol_util.html#pymol_util.contractRadii">[docs]</a><span class="k">def</span> <span class="nf">contractRadii</span><span class="p">(</span><span class="n">delta</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">sel</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">:</span>
		<span class="n">r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">vdw</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;index &quot;</span><span class="o">+</span><span class="sb">`a.index`</span><span class="p">,</span> <span class="s">&#39;vdw = &#39;</span><span class="o">+</span><span class="sb">`r`</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">rebuild</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="s">&quot;spheres&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="useOccColors"><a class="viewcode-back" href="../pymol_util.html#pymol_util.useOccColors">[docs]</a><span class="k">def</span> <span class="nf">useOccColors</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">):</span>
	<span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span><span class="o">.</span><span class="n">atom</span><span class="p">:</span>
		<span class="n">d</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
	<span class="n">colors</span> <span class="o">=</span> <span class="n">rainbow</span>
	<span class="c"># random.shuffle(colors)</span>
	<span class="c"># colors *= len(d)/len(colors)+1</span>
	<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span> <span class="n">colors</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> and q = </span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">ii</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="useTempColors"><a class="viewcode-back" href="../pymol_util.html#pymol_util.useTempColors">[docs]</a><span class="k">def</span> <span class="nf">useTempColors</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">:</span>
		<span class="n">q</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">b</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">intcolors</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="n">floor</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">intcolors</span><span class="p">)</span> <span class="p">]</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span> <span class="n">c</span> <span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> and resi </span><span class="si">%s</span><span class="s"> and name </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">resi</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="useOccRadii"><a class="viewcode-back" href="../pymol_util.html#pymol_util.useOccRadii">[docs]</a><span class="k">def</span> <span class="nf">useOccRadii</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">:</span>
		<span class="n">q</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">q</span>
		<span class="k">if</span> <span class="n">q</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
			<span class="k">print</span> <span class="s">&quot;shrik radius&quot;</span>
			<span class="n">q</span> <span class="o">&lt;-</span> <span class="mf">0.1</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> and resi </span><span class="si">%s</span><span class="s"> and name </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">resi</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="s">&quot;vdw = </span><span class="si">%f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">rebuild</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="useTempRadii"><a class="viewcode-back" href="../pymol_util.html#pymol_util.useTempRadii">[docs]</a><span class="k">def</span> <span class="nf">useTempRadii</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
		<span class="n">radius</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%0.1f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="n">sel</span><span class="o">+</span><span class="s">&quot; and b = &quot;</span><span class="o">+</span><span class="n">radius</span><span class="p">,</span> <span class="s">&quot;vdw = &quot;</span><span class="o">+</span><span class="n">radius</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">rebuild</span><span class="p">()</span>



<span class="c">######## general utils #############</span>
</div>
<div class="viewcode-block" id="natom"><a class="viewcode-back" href="../pymol_util.html#pymol_util.natom">[docs]</a><span class="k">def</span> <span class="nf">natom</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="nca"><a class="viewcode-back" href="../pymol_util.html#pymol_util.nca">[docs]</a><span class="k">def</span> <span class="nf">nca</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">natom</span><span class="p">(</span><span class="s">&quot;( &quot;</span><span class="o">+</span><span class="n">sel</span><span class="o">+</span><span class="s">&quot; and (name ca))&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="chaincount"><a class="viewcode-back" href="../pymol_util.html#pymol_util.chaincount">[docs]</a><span class="k">def</span> <span class="nf">chaincount</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span><span class="p">):</span>
	<span class="n">cc</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">getchain</span><span class="p">(</span><span class="n">sel</span><span class="p">):</span>
		<span class="n">cc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&quot;( &quot;</span><span class="o">+</span><span class="n">sel</span><span class="o">+</span><span class="s">&quot;) and (chain </span><span class="si">%s</span><span class="s">) and (not (HET and not resn MSE+CSW))&quot;</span><span class="o">%</span><span class="n">c</span><span class="p">),</span> <span class="n">c</span><span class="p">))</span>
	<span class="n">cc</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">cc</span>
</div>
<span class="n">name1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;ALA&quot;</span><span class="p">:</span><span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="s">&quot;CYS&quot;</span><span class="p">:</span><span class="s">&quot;C&quot;</span><span class="p">,</span> <span class="s">&quot;ASP&quot;</span><span class="p">:</span><span class="s">&quot;D&quot;</span><span class="p">,</span> <span class="s">&quot;GLU&quot;</span><span class="p">:</span><span class="s">&quot;E&quot;</span><span class="p">,</span> <span class="s">&quot;PHE&quot;</span><span class="p">:</span><span class="s">&quot;F&quot;</span><span class="p">,</span> <span class="s">&quot;GLY&quot;</span><span class="p">:</span><span class="s">&quot;G&quot;</span><span class="p">,</span> <span class="s">&quot;HIS&quot;</span><span class="p">:</span><span class="s">&quot;H&quot;</span><span class="p">,</span> <span class="s">&quot;ILE&quot;</span><span class="p">:</span><span class="s">&quot;I&quot;</span><span class="p">,</span> <span class="s">&quot;LYS&quot;</span><span class="p">:</span><span class="s">&quot;K&quot;</span><span class="p">,</span> <span class="s">&quot;LEU&quot;</span><span class="p">:</span><span class="s">&quot;L&quot;</span><span class="p">,</span>
		 <span class="s">&quot;MET&quot;</span><span class="p">:</span><span class="s">&quot;xyz.Mat&quot;</span><span class="p">,</span> <span class="s">&quot;ASN&quot;</span><span class="p">:</span><span class="s">&quot;N&quot;</span><span class="p">,</span> <span class="s">&quot;PRO&quot;</span><span class="p">:</span><span class="s">&quot;P&quot;</span><span class="p">,</span> <span class="s">&quot;GLN&quot;</span><span class="p">:</span><span class="s">&quot;Q&quot;</span><span class="p">,</span> <span class="s">&quot;ARG&quot;</span><span class="p">:</span><span class="s">&quot;R&quot;</span><span class="p">,</span> <span class="s">&quot;SER&quot;</span><span class="p">:</span><span class="s">&quot;S&quot;</span><span class="p">,</span> <span class="s">&quot;THR&quot;</span><span class="p">:</span><span class="s">&quot;T&quot;</span><span class="p">,</span> <span class="s">&quot;VAL&quot;</span><span class="p">:</span><span class="s">&quot;xyz.Vec&quot;</span><span class="p">,</span> <span class="s">&quot;TRP&quot;</span><span class="p">:</span><span class="s">&quot;W&quot;</span><span class="p">,</span> <span class="s">&quot;TYR&quot;</span><span class="p">:</span><span class="s">&quot;Uy&quot;</span><span class="p">,</span>
		 <span class="s">&quot;MSE&quot;</span><span class="p">:</span><span class="s">&quot;xyz.Mat&quot;</span><span class="p">,</span> <span class="s">&quot;CSW&quot;</span><span class="p">:</span><span class="s">&quot;C&quot;</span><span class="p">}</span>

<div class="viewcode-block" id="lcs"><a class="viewcode-back" href="../pymol_util.html#pymol_util.lcs">[docs]</a><span class="k">def</span> <span class="nf">lcs</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
	 <span class="n">L</span> <span class="o">=</span> <span class="p">{}</span>
	 <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
	 <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
	 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)):</span>
		 <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)):</span>
			 <span class="n">L</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
			 <span class="k">if</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">T</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
				 <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
					 <span class="n">L</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
				 <span class="k">else</span><span class="p">:</span>
					 <span class="n">L</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">+</span> <span class="mi">1</span>
				 <span class="k">if</span> <span class="n">L</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">:</span>
					 <span class="n">z</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
					 <span class="n">ret</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">-</span><span class="n">z</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span>
	 <span class="k">return</span> <span class="n">ret</span>

<span class="c">################## symmetry utils ###################</span>


<span class="c">#############################################################################################################</span>

<span class="c"># unscramble DX symmetry, seems to have a bug</span>
<span class="c"># computes COMs, tries to find the double-ring pattern</span>
<span class="c"># NO GOOD: think of rotational offset</span></div>
<div class="viewcode-block" id="sort_dcoms"><a class="viewcode-back" href="../pymol_util.html#pymol_util.sort_dcoms">[docs]</a><span class="k">def</span> <span class="nf">sort_dcoms</span><span class="p">(</span><span class="n">subs</span><span class="p">):</span>
  <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="k">assert</span> <span class="s">&quot;tmp</span><span class="si">%i</span><span class="s">A&quot;</span><span class="o">%</span><span class="n">i</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="k">assert</span> <span class="s">&quot;tmp</span><span class="si">%i</span><span class="s">B&quot;</span><span class="o">%</span><span class="n">i</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">()</span>
  <span class="n">coms</span> <span class="o">=</span> <span class="p">[</span><span class="n">com</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subs</span><span class="p">]</span>
  <span class="n">tmp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">coms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coms</span><span class="p">)]</span>
  <span class="n">tmp</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
  <span class="n">td</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">ring</span> <span class="o">=</span> <span class="p">[</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">td</span> <span class="k">else</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">2</span> <span class="k">if</span> <span class="n">td</span> <span class="k">else</span> <span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span>
  <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
	 <span class="n">tmp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">coms</span><span class="p">[</span><span class="n">ring</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coms</span><span class="p">)]</span>
	 <span class="n">tmp</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
	 <span class="k">assert</span> <span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">td</span>
	 <span class="n">v1</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">td</span> <span class="k">else</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
	 <span class="n">v2</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">2</span> <span class="k">if</span> <span class="n">td</span> <span class="k">else</span> <span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
	 <span class="k">assert</span> <span class="n">ring</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
	 <span class="n">ring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">v1</span> <span class="k">if</span> <span class="n">v2</span> <span class="o">==</span> <span class="n">ring</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">else</span> <span class="n">v2</span> <span class="p">)</span>
  <span class="c">#print ring</span>
  <span class="c">#print [subs[i] for i in ring]</span>
  <span class="n">namemap</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ring</span><span class="p">):</span>
	 <span class="k">assert</span> <span class="ow">not</span> <span class="n">subs</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="ow">in</span> <span class="n">namemap</span>
	 <span class="n">namemap</span><span class="p">[</span><span class="n">subs</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span> <span class="o">=</span> <span class="s">&quot;sub</span><span class="si">%i</span><span class="s">A&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
	 <span class="n">tmp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">coms</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coms</span><span class="p">)]</span>
	 <span class="n">tmp</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
	 <span class="c">#print r, [subs[x[1]] for x in tmp]</span>
	 <span class="n">sub_partner</span> <span class="o">=</span> <span class="n">subs</span><span class="p">[</span><span class="n">tmp</span><span class="p">[</span><span class="mi">3</span> <span class="k">if</span> <span class="n">td</span> <span class="k">else</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
	 <span class="k">assert</span> <span class="ow">not</span> <span class="n">sub_partner</span> <span class="ow">in</span> <span class="n">namemap</span>
	 <span class="n">namemap</span><span class="p">[</span><span class="n">sub_partner</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;sub</span><span class="si">%i</span><span class="s">B&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">namemap</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">2</span><span class="o">*</span><span class="n">N</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="k">assert</span> <span class="s">&quot;tmp</span><span class="si">%i</span><span class="s">A&quot;</span><span class="o">%</span><span class="n">i</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="k">assert</span> <span class="s">&quot;tmp</span><span class="si">%i</span><span class="s">B&quot;</span><span class="o">%</span><span class="n">i</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">()</span>
  <span class="n">chains</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
	 <span class="n">chains</span><span class="p">[</span><span class="s">&quot;sub</span><span class="si">%i</span><span class="s">A&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">uppercase</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">0</span><span class="p">]</span>
	 <span class="n">chains</span><span class="p">[</span><span class="s">&quot;sub</span><span class="si">%i</span><span class="s">B&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">uppercase</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">namemap</span><span class="p">:</span>
	 <span class="n">cmd</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">namemap</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
	 <span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="n">namemap</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="s">&quot;chain = &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="o">%</span><span class="n">chains</span><span class="p">[</span><span class="n">namemap</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span> <span class="k">assert</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="procD5dat"><a class="viewcode-back" href="../pymol_util.html#pymol_util.procD5dat">[docs]</a><span class="k">def</span> <span class="nf">procD5dat</span><span class="p">(</span><span class="n">lfile</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">biod</span> <span class="o">=</span> <span class="s">&quot;/data/biounit&quot;</span><span class="p">,</span> <span class="n">outd</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="k">if</span> <span class="n">outd</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">outd</span> <span class="o">=</span> <span class="s">&quot;/Users/sheffler/project/sym_comp/D</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">N</span>
  <span class="k">print</span> <span class="n">outd</span>
  <span class="n">Nnobio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">Nok</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">Ncontact</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">Nbig</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">Nnsym</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">Nnomxatm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">Nhomogen</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">files</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lfile</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">lfile</span> <span class="k">else</span> <span class="nb">map</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">,</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">biod</span><span class="o">+</span><span class="s">&quot;/*&quot;</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
	 <span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
	 <span class="n">pdb</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fn</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
	 <span class="n">bnum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span>
	 <span class="k">print</span> <span class="n">fn</span><span class="p">,</span> <span class="n">pdb</span><span class="p">,</span> <span class="n">bnum</span>
	 <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outd</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">pdb</span><span class="o">+</span><span class="s">&quot;_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">bnum</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;_sub1.pdb&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outd</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">pdb</span><span class="o">+</span><span class="s">&quot;_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">bnum</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;_sub1.pdb.gz&quot;</span><span class="p">):</span>
		<span class="n">Nok</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="k">continue</span>
	 <span class="n">fname</span> <span class="o">=</span> <span class="n">biod</span><span class="o">+</span><span class="s">&quot;/&quot;</span><span class="o">+</span><span class="n">fn</span>
	 <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span> <span class="n">fname</span> <span class="o">+=</span> <span class="s">&quot;.gz&quot;</span>
	 <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
		<span class="n">Nnobio</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="k">continue</span>
	 <span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">)</span>
	 <span class="n">cmd</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">)</span>
	 <span class="n">cmd</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;resn HOH&quot;</span><span class="p">)</span>
	 <span class="n">cmd</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;not alt a+&quot;&quot;&#39;</span><span class="p">)</span>
	 <span class="n">hf</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&quot;(HET and not resn MSE+CSW)&quot;</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&quot;ALL&quot;</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
	 <span class="k">if</span> <span class="n">hf</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span> <span class="k">continue</span>
	 <span class="n">cmd</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;(HET and not resn MSE+CSW) and not name n+ca+c+o+cb&quot;</span><span class="p">)</span>
	 <span class="k">assert</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">)</span>
	 <span class="k">assert</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span>  <span class="n">N</span><span class="p">)</span>
	 <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&#39;all&#39;</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">cc</span> <span class="o">=</span> <span class="n">chaincount</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
		  <span class="n">Nnsym</span> <span class="o">+=</span> <span class="mi">1</span>
		  <span class="k">continue</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
		  <span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;sub</span><span class="si">%i</span><span class="s">A&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="s">&quot;m and chain </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">cc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		  <span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;sub</span><span class="si">%i</span><span class="s">B&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span> <span class="s">&quot;m and chain </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">cc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">continue</span>
	 <span class="k">else</span><span class="p">:</span>
		<span class="n">cc</span> <span class="o">=</span> <span class="n">chaincount</span><span class="p">(</span><span class="s">&quot;m&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">N</span><span class="p">:</span>
		  <span class="n">Nnsym</span> <span class="o">+=</span> <span class="mi">1</span>
		  <span class="k">continue</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">c</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s">&quot;AB&quot;</span><span class="p">]):</span>
		  <span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;tmp</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">l</span><span class="p">,</span> <span class="s">&quot;m and chain </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">cc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">sort_dcoms</span><span class="p">([</span><span class="s">&quot;tmp&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">c</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s">&quot;AB&quot;</span><span class="p">])</span>
	 <span class="k">for</span> <span class="n">slct</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;sub&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">c</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s">&quot;AB&quot;</span><span class="p">]:</span>
		 <span class="k">if</span> <span class="n">iscontig</span><span class="p">(</span><span class="n">slct</span><span class="p">):</span>
			 <span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;mxatm&quot;</span><span class="p">,</span> <span class="n">slct</span><span class="p">)</span>
			 <span class="k">break</span>
	 <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&quot;name CA and mxatm&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">250</span><span class="p">:</span>
		 <span class="n">Nbig</span> <span class="o">+=</span> <span class="mi">1</span>
		 <span class="k">continue</span>
	 <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">&quot;mxatm&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
		 <span class="n">Nnomxatm</span> <span class="o">+=</span> <span class="mi">1</span>
		 <span class="k">continue</span>
	 <span class="n">chains</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;sub&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="n">c</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="s">&quot;AB&quot;</span><span class="p">]</span>
	 <span class="n">done</span> <span class="o">=</span> <span class="bp">False</span>
	 <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
	 <span class="c"># while not done and count &lt; 50:</span>
	 <span class="c">#    done = True</span>
	 <span class="c">#    random.shuffle(chains)</span>
	 <span class="c">#    for i in range(len(chains)):</span>
	 <span class="c">#       for j in range(i+1, len(chains)):</span>
	 <span class="c">#          done = done and homogenizechains(chains[i], chains[j])</span>
	 <span class="c">#    count += 1</span>
	 <span class="c"># if count &gt;= 50:</span>
	 <span class="c">#    Nhomogen += 1</span>
	 <span class="c">#    continue</span>
	 <span class="c"># if cmd.select(&quot;mxatm&quot;) &lt; 50:</span>
	 <span class="c">#    Nnomxatm += 1</span>
	 <span class="c">#    continue</span>
	 <span class="c"># cm = com(&quot;sub*&quot;)</span>
	 <span class="c"># for s in chains: trans(s, -cm)</span>
	 <span class="c"># sel = &quot; or &quot;.join(chains)</span>
	 <span class="c"># a1 = c5axis(&quot;sub*&quot;, None, [&quot;A&quot;, &quot;C&quot;, &quot;E&quot;, &quot;G&quot;, &quot;I&quot;])</span>
	 <span class="c"># alignaxis(sel, xyz.Vec(0, 0, 1), a1, xyz.Vec(0, 0, 0))</span>
	 <span class="c"># a2 = c2axis(&quot;sub*&quot;, None, [&quot;A&quot;, &quot;B&quot;])</span>
	 <span class="c"># a2.z = 0.0</span>
	 <span class="c"># a2.normalize()</span>
	 <span class="c"># alignaxis(sel, xyz.Vec(0, 1, 0), a2, xyz.Vec(0, 0, 0))</span>
	 <span class="c"># cmd.align(&quot;mxatm&quot;, &quot;sub1A&quot;)</span>
	 <span class="c"># if not os.path.exists(outd): os.mkdir(outd)</span>
	 <span class="c"># cmd.save(outd+&quot;/&quot;+pdb+&quot;_&quot;+str(bnum)+&quot;_sub1.pdb&quot;, &quot;mxatm&quot;)</span>
	 <span class="c"># Nok += 1</span>
  <span class="k">print</span> <span class="n">Nok</span><span class="p">,</span> <span class="n">Nbig</span><span class="p">,</span> <span class="n">Nnsym</span><span class="p">,</span> <span class="n">Ncontact</span><span class="p">,</span> <span class="n">Nnobio</span><span class="p">,</span> <span class="n">Nnomxatm</span><span class="p">,</span> <span class="n">Nhomogen</span>

</div>
<div class="viewcode-block" id="untangle_sidechains"><a class="viewcode-back" href="../pymol_util.html#pymol_util.untangle_sidechains">[docs]</a><span class="k">def</span> <span class="nf">untangle_sidechains</span><span class="p">(</span><span class="n">sele</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">getres</span><span class="p">(</span><span class="n">sele</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span> <span class="n">cmd</span><span class="o">.</span><span class="n">unbond</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> and resi </span><span class="si">%i</span><span class="s"> and chain </span><span class="si">%s</span><span class="s"> and not name N+C&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sele</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="s">&quot;not (</span><span class="si">%s</span><span class="s"> and resi </span><span class="si">%i</span><span class="s"> and chain </span><span class="si">%s</span><span class="s">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sele</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>       <span class="n">cmd</span><span class="o">.</span><span class="n">unbond</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> and resi </span><span class="si">%i</span><span class="s"> and              not name N+C&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sele</span><span class="p">,</span> <span class="n">i</span>  <span class="p">),</span> <span class="s">&quot;not (</span><span class="si">%s</span><span class="s"> and resi </span><span class="si">%i</span><span class="s">             )&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sele</span><span class="p">,</span> <span class="n">i</span>  <span class="p">))</span>
</div>
<div class="viewcode-block" id="orb_cyl"><a class="viewcode-back" href="../pymol_util.html#pymol_util.orb_cyl">[docs]</a><span class="k">def</span> <span class="nf">orb_cyl</span><span class="p">(</span><span class="n">lab</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">lab</span><span class="o">+</span><span class="s">&quot;o1&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">lab</span><span class="o">+</span><span class="s">&quot;o2&quot;</span><span class="p">)</span>
	<span class="n">p1</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="s">&#39;pk1&#39;</span><span class="p">)</span>
	<span class="n">p2</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="s">&#39;pk2&#39;</span><span class="p">)</span>
	<span class="n">p3</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="s">&#39;pk3&#39;</span><span class="p">)</span>
	<span class="n">dr</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span><span class="o">-</span><span class="n">p2</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="n">ax</span> <span class="o">=</span> <span class="p">(</span><span class="n">p3</span><span class="o">-</span><span class="n">p2</span><span class="p">)</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">p1</span><span class="o">-</span><span class="n">p2</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="n">o1</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">rotation_matrix_degrees</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">)</span><span class="o">*</span><span class="n">dr</span>
	<span class="n">o2</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">rotation_matrix_degrees</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="o">-</span><span class="mf">60.0</span><span class="p">)</span><span class="o">*</span><span class="n">dr</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">o1</span><span class="o">.</span><span class="n">cgofrompoint</span><span class="p">(</span><span class="n">p1</span><span class="p">),</span> <span class="n">lab</span><span class="o">+</span><span class="s">&quot;o1&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">o2</span><span class="o">.</span><span class="n">cgofrompoint</span><span class="p">(</span><span class="n">p1</span><span class="p">),</span> <span class="n">lab</span><span class="o">+</span><span class="s">&quot;o2&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="drawring"><a class="viewcode-back" href="../pymol_util.html#pymol_util.drawring">[docs]</a><span class="k">def</span> <span class="nf">drawring</span><span class="p">(</span> <span class="n">p1</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lab</span> <span class="o">=</span> <span class="s">&quot;ring&quot;</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">p1</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="s">&#39;pk1&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">p2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="s">&#39;pk2&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">p3</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="s">&#39;pk3&#39;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
	<span class="n">axs</span> <span class="o">=</span> <span class="p">(</span><span class="n">p2</span><span class="o">-</span><span class="n">p1</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

	<span class="n">obj</span> <span class="o">=</span> <span class="p">[</span> <span class="n">BEGIN</span><span class="p">,</span> <span class="n">LINE_LOOP</span><span class="p">,</span>   <span class="n">COLOR</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>  <span class="p">]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
		<span class="n">st</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">rotation_matrix_degrees</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">i</span>  <span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p3</span><span class="o">-</span><span class="n">p2</span><span class="p">)</span><span class="o">+</span><span class="n">p2</span>
		<span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="p">[</span> <span class="n">VERTEX</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="p">]</span> <span class="p">)</span>

	<span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">END</span> <span class="p">)</span>

	<span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">lab</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="drawringcar"><a class="viewcode-back" href="../pymol_util.html#pymol_util.drawringcar">[docs]</a><span class="k">def</span> <span class="nf">drawringcar</span><span class="p">(</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lab</span> <span class="o">=</span> <span class="s">&quot;ring&quot;</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
	<span class="n">p1</span> <span class="o">=</span> <span class="n">c</span>
	<span class="n">p2</span> <span class="o">=</span> <span class="n">c</span><span class="o">+</span><span class="n">a</span>
	<span class="n">p3</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">xyz</span><span class="o">.</span><span class="n">projperp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="n">drawring</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">lab</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="drawsph"><a class="viewcode-back" href="../pymol_util.html#pymol_util.drawsph">[docs]</a><span class="k">def</span> <span class="nf">drawsph</span><span class="p">(</span><span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lab</span> <span class="o">=</span> <span class="s">&quot;sph&quot;</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
	<span class="n">p1</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="s">&#39;pk1&#39;</span><span class="p">)</span>
	<span class="n">p2</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="s">&#39;pk2&#39;</span><span class="p">)</span>
	<span class="n">p3</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="s">&#39;pk3&#39;</span><span class="p">)</span>
	<span class="n">p4</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="s">&#39;pk4&#39;</span><span class="p">)</span>
	<span class="n">axs1</span> <span class="o">=</span> <span class="p">(</span><span class="n">p2</span><span class="o">-</span><span class="n">p1</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="n">axs2</span> <span class="o">=</span> <span class="p">(</span><span class="n">p3</span><span class="o">-</span><span class="n">p2</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>

	<span class="n">obj</span> <span class="o">=</span> <span class="p">[</span> <span class="n">BEGIN</span><span class="p">,</span> <span class="p">]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
		<span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="p">[</span> <span class="n">LINE_LOOP</span><span class="p">,</span>   <span class="n">COLOR</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>  <span class="p">]</span> <span class="p">)</span>
		<span class="n">axs</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">rotation_matrix_degrees</span><span class="p">(</span><span class="n">axs1</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">axs2</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
			<span class="n">st</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">rotation_matrix_degrees</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p4</span><span class="o">-</span><span class="n">p2</span><span class="p">)</span><span class="o">+</span><span class="n">p2</span>
			<span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="p">[</span> <span class="n">VERTEX</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">st</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="p">]</span> <span class="p">)</span>
	<span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">END</span> <span class="p">)</span>

	<span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">lab</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dsf"><a class="viewcode-back" href="../pymol_util.html#pymol_util.dsf">[docs]</a><span class="k">def</span> <span class="nf">dsf</span><span class="p">(</span><span class="n">CA1</span><span class="p">,</span> <span class="n">CB1</span><span class="p">,</span> <span class="n">CA2</span><span class="p">,</span> <span class="n">CB2</span><span class="p">,</span> <span class="n">lab</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
	<span class="n">c</span> <span class="o">=</span> <span class="n">CA1</span><span class="o">+</span><span class="p">(</span><span class="n">CB1</span><span class="o">-</span><span class="n">CA1</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span><span class="o">*</span><span class="mf">2.27887</span>
	<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">CB1</span><span class="o">-</span><span class="n">CA1</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="n">r</span> <span class="o">=</span> <span class="mf">1.6454076</span>
	<span class="n">drawringcar</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s">&#39;cr&#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">)</span>
	<span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">CB2</span><span class="p">)</span>
	<span class="n">r2</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="mf">3.0</span><span class="o">*</span><span class="mf">3.0</span> <span class="o">-</span> <span class="n">d</span><span class="o">*</span><span class="n">d</span> <span class="p">)</span>
	<span class="n">c2</span> <span class="o">=</span> <span class="n">CB2</span> <span class="o">+</span> <span class="n">d</span><span class="o">*</span><span class="n">a</span>
	<span class="n">a2</span> <span class="o">=</span> <span class="n">a</span>
	<span class="n">drawringcar</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s">&#39;cd&#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">)</span>
	<span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">c2</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="p">()</span>
	<span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="n">d</span><span class="o">*</span><span class="n">d</span><span class="o">-</span><span class="n">r2</span><span class="o">*</span><span class="n">r2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">d</span>
	<span class="n">x</span> <span class="o">=</span> <span class="n">d2</span> <span class="o">*</span> <span class="p">(</span><span class="n">c2</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span> <span class="o">+</span> <span class="n">c</span>
	<span class="n">h</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">r</span> <span class="o">-</span> <span class="n">d2</span><span class="o">*</span><span class="n">d2</span><span class="p">)</span>
	<span class="n">a3</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">c2</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
	<span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">h</span><span class="o">*</span><span class="n">a3</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&#39;p1&#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">)</span>
	<span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="n">a3</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&#39;p2&#39;</span><span class="o">+</span><span class="n">lab</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="alignallrms"><a class="viewcode-back" href="../pymol_util.html#pymol_util.alignallrms">[docs]</a><span class="k">def</span> <span class="nf">alignallrms</span><span class="p">(</span><span class="n">sele</span><span class="p">):</span>
	<span class="n">r</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">():</span>
		<span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="s">&#39;fr52re&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">print</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span>
</div>
<div class="viewcode-block" id="mkpntx"><a class="viewcode-back" href="../pymol_util.html#pymol_util.mkpntx">[docs]</a><span class="k">def</span> <span class="nf">mkpntx</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
	<span class="n">x</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span><span class="o">-</span><span class="n">com</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.1</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;DIE!&quot;</span><span class="p">,</span> <span class="n">x</span>
		<span class="k">return</span>
	<span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">z</span>
	<span class="n">c</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="mf">36.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">),</span> <span class="n">z</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;p1&#39;</span><span class="p">);</span>   <span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;p2&#39;</span><span class="p">);</span>   <span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;p3&#39;</span><span class="p">);</span>   <span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;p4&#39;</span><span class="p">);</span>   <span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;p5&#39;</span>   <span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;p1&#39;</span><span class="p">,</span> <span class="n">s1</span><span class="p">);</span><span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;p2&#39;</span><span class="p">,</span> <span class="n">s1</span><span class="p">);</span><span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;p3&#39;</span><span class="p">,</span> <span class="n">s1</span><span class="p">);</span><span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;p4&#39;</span><span class="p">,</span> <span class="n">s1</span><span class="p">);</span><span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&#39;p5&#39;</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&#39;p1&#39;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="o">*</span><span class="mi">72</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&#39;p2&#39;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="o">*</span><span class="mi">72</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&#39;p3&#39;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="o">*</span><span class="mi">72</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&#39;p4&#39;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="o">*</span><span class="mi">72</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&#39;p5&#39;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">4</span><span class="o">*</span><span class="mi">72</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&#39;green&#39;</span>  <span class="p">,</span> <span class="s">&#39;p1 and elem C&#39;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&#39;cyan&#39;</span>   <span class="p">,</span> <span class="s">&#39;p2 and elem C&#39;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&#39;yellow&#39;</span> <span class="p">,</span> <span class="s">&#39;p3 and elem C&#39;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span> <span class="s">&#39;p4 and elem C&#39;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&#39;orange&#39;</span> <span class="p">,</span> <span class="s">&#39;p5 and elem C&#39;</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">ifsphab</span><span class="p">():</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&quot;spheres&quot;</span><span class="p">,</span> <span class="s">&quot;((vis and chain A) within 6 of (vis and chain B)) or ((vis and chain B) within 6 of (vis and chain A))&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ifsphab"><a class="viewcode-back" href="../pymol_util.html#pymol_util.ifsphab">[docs]</a><span class="k">def</span> <span class="nf">ifsphab</span><span class="p">():</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&quot;sticks&quot;</span><span class="p">,</span> <span class="s">&quot;byres (((vis and chain C) within 8 of (vis and chain A)) or ((vis and chain B) within 8 of (vis and chain A)))&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&quot;sticks&quot;</span><span class="p">,</span> <span class="s">&quot;chain A&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="charge"><a class="viewcode-back" href="../pymol_util.html#pymol_util.charge">[docs]</a><span class="k">def</span> <span class="nf">charge</span><span class="p">(</span><span class="n">sel</span><span class="p">):</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sel</span><span class="o">+</span><span class="s">&quot; and name CA and resn LYS+ARG&quot;</span><span class="p">)</span>
	<span class="n">n</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sel</span><span class="o">+</span><span class="s">&quot; and name CA and resn GLU+ASP&quot;</span><span class="p">)</span>
	<span class="k">print</span> <span class="n">p</span><span class="o">-</span><span class="n">n</span>
</div>
<div class="viewcode-block" id="redoA"><a class="viewcode-back" href="../pymol_util.html#pymol_util.redoA">[docs]</a><span class="k">def</span> <span class="nf">redoA</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;not sub&quot;</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;sub*&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="s">&quot;ev&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="o">+</span><span class="s">&quot; and not chain A&quot;</span><span class="p">)</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
	<span class="n">chains</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">chain</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s">&quot;name ca&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">))</span>
	<span class="n">chains</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">N</span><span class="p">:</span> <span class="n">chains</span> <span class="o">=</span> <span class="n">chains</span><span class="p">[:</span><span class="n">N</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;A&quot;</span><span class="p">:</span> <span class="k">continue</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;sub&quot;</span><span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="n">sel</span><span class="o">+</span><span class="s">&quot; and chain A&quot;</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">align</span><span class="p">(</span> <span class="s">&quot;sub&quot;</span><span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="n">sel</span><span class="o">+</span><span class="s">&quot; and chain &quot;</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span> <span class="s">&quot;sub&quot;</span><span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="s">&quot;chain = &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="o">%</span><span class="n">c</span><span class="p">)</span>
	<span class="n">color_by_chain</span><span class="p">()</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
	<span class="k">print</span> <span class="n">charge</span><span class="p">(</span><span class="n">sel</span><span class="o">+</span><span class="s">&quot; and chain A&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="redotoi"><a class="viewcode-back" href="../pymol_util.html#pymol_util.redotoi">[docs]</a><span class="k">def</span> <span class="nf">redotoi</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;not sub*&quot;</span><span class="p">):</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;sub*&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;subB&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;subC&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">axs</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="s">&#39;chain A and name ZN&#39;</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;subB&quot;</span><span class="p">,</span> <span class="n">axs</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;subC&quot;</span><span class="p">,</span> <span class="n">axs</span><span class="p">,</span> <span class="mi">240</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;subB and chain A&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;E&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;subB and chain B&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;F&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;subB and chain C&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;G&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;subB and chain D&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;H&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;subC and chain A&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;I&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;subC and chain B&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;J&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;subC and chain C&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;K&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;subC and chain D&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;L&#39;&quot;</span><span class="p">)</span>
	<span class="n">color_by_chain</span><span class="p">()</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
	<span class="k">print</span> <span class="n">charge</span><span class="p">(</span><span class="s">&quot;chain A&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="redopent"><a class="viewcode-back" href="../pymol_util.html#pymol_util.redopent">[docs]</a><span class="k">def</span> <span class="nf">redopent</span><span class="p">(</span><span class="n">sel</span><span class="p">):</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;chain B+C+D+E&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;pnt*&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;pntB&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;pntC&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;pntD&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;pntE&quot;</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;pntB&quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">72</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;pntC&quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">144</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;pntD&quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">216</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;pntE&quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">288</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&quot;green&quot;</span>   <span class="p">,</span> <span class="n">sel</span><span class="o">+</span><span class="s">&quot; and elem C&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&quot;cyan&quot;</span>   <span class="p">,</span> <span class="s">&quot;pntB and elem C&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&quot;magenta&quot;</span><span class="p">,</span> <span class="s">&quot;pntC and elem C&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&quot;yellow&quot;</span> <span class="p">,</span> <span class="s">&quot;pntD and elem C&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="s">&quot;pink&quot;</span>   <span class="p">,</span> <span class="s">&quot;pntE and elem C&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;pntB&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;B&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;pntC&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;C&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;pntD&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;D&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;pntE&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;E&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
	<span class="k">print</span> <span class="n">charge</span><span class="p">(</span><span class="s">&quot;chain A&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="getaa"><a class="viewcode-back" href="../pymol_util.html#pymol_util.getaa">[docs]</a><span class="k">def</span> <span class="nf">getaa</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span><span class="p">):</span>
	<span class="n">m</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> and chain </span><span class="si">%s</span><span class="s"> and resi </span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">)))</span>
	<span class="k">return</span> <span class="n">aa_3_1</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">atom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resn</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="mkifaceresfile"><a class="viewcode-back" href="../pymol_util.html#pymol_util.mkifaceresfile">[docs]</a><span class="k">def</span> <span class="nf">mkifaceresfile</span><span class="p">(</span><span class="n">fn</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
	<span class="n">sel</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
	<span class="n">fn</span> <span class="o">+=</span> <span class="s">&quot;.resfile&quot;</span>
	<span class="n">o</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
	<span class="k">if</span> <span class="n">fn</span><span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
	<span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">o</span><span class="p">,</span> <span class="s">&quot;&quot;&quot;AUTO</span><span class="se">\n</span><span class="s">NATRO</span><span class="se">\n\n</span><span class="s">start&quot;&quot;&quot;</span>
	<span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">getres</span><span class="p">(</span><span class="s">&quot;(chain A and (</span><span class="si">%s</span><span class="s">)) within 5 of (chain B and (</span><span class="si">%s</span><span class="s">))&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="n">sel</span><span class="p">)):</span>
		<span class="k">assert</span> <span class="n">c</span> <span class="o">==</span> <span class="s">&quot;A&quot;</span>
		<span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">o</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%4d</span><span class="s"> A PIKAA </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">getaa</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
	<span class="k">if</span> <span class="n">fn</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="color_by_chain"><a class="viewcode-back" href="../pymol_util.html#pymol_util.color_by_chain">[docs]</a><span class="k">def</span> <span class="nf">color_by_chain</span><span class="p">():</span>
	<span class="n">chains</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">chain</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s">&quot;name ca&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span><span class="p">)</span>
	<span class="k">print</span> <span class="n">chains</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chains</span><span class="p">):</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">COLORS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">&quot;chain </span><span class="si">%s</span><span class="s"> and elem C&quot;</span><span class="o">%</span><span class="n">c</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="getnative"><a class="viewcode-back" href="../pymol_util.html#pymol_util.getnative">[docs]</a><span class="k">def</span> <span class="nf">getnative</span><span class="p">():</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
	<span class="n">nats</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">():</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
			<span class="n">nats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="n">pid</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">nats</span><span class="p">:</span> <span class="k">continue</span>
		<span class="k">print</span> <span class="s">&quot;fetching native&quot;</span><span class="p">,</span> <span class="n">pid</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pid</span><span class="o">+</span><span class="s">&quot; and not chain A&quot;</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pid</span><span class="o">+</span><span class="s">&quot; and resn HOH&quot;</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="makecx"><a class="viewcode-back" href="../pymol_util.html#pymol_util.makecx">[docs]</a><span class="k">def</span> <span class="nf">makecx</span><span class="p">(</span><span class="n">sel</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;C</span><span class="si">%i</span><span class="s">_*&quot;</span><span class="o">%</span><span class="n">n</span><span class="p">)</span>
	<span class="n">chains</span> <span class="o">=</span> <span class="s">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;C</span><span class="si">%i</span><span class="s">_</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">sel</span><span class="o">+</span><span class="s">&quot; and (not C</span><span class="si">%i</span><span class="s">_*)&quot;</span><span class="o">%</span><span class="n">n</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="n">rot</span><span class="p">(</span><span class="s">&quot;C</span><span class="si">%i</span><span class="s">_</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">Uz</span><span class="p">,</span> <span class="mf">360.0</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;C</span><span class="si">%i</span><span class="s">_</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="s">&quot;chain = &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="o">%</span><span class="n">chains</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</div>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">21</span><span class="p">):</span>
		<span class="nb">globals</span><span class="p">()[</span><span class="s">&#39;makec</span><span class="si">%i</span><span class="s">&#39;</span><span class="o">%</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">makecx</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>

<div class="viewcode-block" id="makecxauto"><a class="viewcode-back" href="../pymol_util.html#pymol_util.makecxauto">[docs]</a><span class="k">def</span> <span class="nf">makecxauto</span><span class="p">():</span>
	<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">():</span>
		<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;_C\d+_&quot;</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">makecx</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="floats2vecs"><a class="viewcode-back" href="../pymol_util.html#pymol_util.floats2vecs">[docs]</a><span class="k">def</span> <span class="nf">floats2vecs</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
	<span class="k">while</span> <span class="mi">1</span><span class="p">:</span> <span class="k">yield</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">(),</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">(),</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="nnb"><a class="viewcode-back" href="../pymol_util.html#pymol_util.nnb">[docs]</a><span class="k">def</span> <span class="nf">nnb</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
	<span class="n">nnb</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">:</span> <span class="n">nnb</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">return</span> <span class="n">nnb</span>
</div>
<div class="viewcode-block" id="testhsphere"><a class="viewcode-back" href="../pymol_util.html#pymol_util.testhsphere">[docs]</a><span class="k">def</span> <span class="nf">testhsphere</span><span class="p">(</span><span class="n">rratio</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">by3</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
		<span class="k">while</span> <span class="mi">1</span><span class="p">:</span> <span class="k">yield</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">(),</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">(),</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;hsphere*&quot;</span><span class="p">)</span>
	<span class="n">lvl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
	<span class="n">crd</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
	<span class="n">nbr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
	<span class="n">cld</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
	<span class="n">pnt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rratio</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">):</span>
		<span class="n">vmult</span> <span class="o">=</span> <span class="p">[(</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">rratio</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="mf">6.0</span><span class="p">)</span> <span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>
	<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rratio</span><span class="p">)</span> <span class="ow">is</span> <span class="mi">7</span><span class="p">:</span>
		<span class="n">vmult</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">rratio</span>
	<span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="s">&quot;/Users/sheffler/Dropbox/project/sphere_hierarchy/hsphere.dat.gz&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">by3</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
			<span class="n">l</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
			<span class="n">lvl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
			<span class="n">pnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
			<span class="n">crd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> <span class="o">*</span> <span class="n">vmult</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)]</span> <span class="p">)</span>
			<span class="n">cld</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s">&quot;65535&quot;</span><span class="p">])</span>
			<span class="n">nbr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s">&quot;65535&quot;</span><span class="p">])</span>
			<span class="c"># print lvl</span>
			<span class="c"># print pnt</span>
			<span class="c"># print crd</span>
			<span class="c"># print cld</span>
			<span class="c"># print nbr</span>
			<span class="c"># return</span>

	<span class="n">obj</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
	<span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="p">[</span> <span class="n">BEGIN</span><span class="p">,</span> <span class="n">POINTS</span> <span class="p">,</span> <span class="n">COLOR</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">]</span> <span class="p">)</span>
	<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">crd</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">VERTEX</span><span class="p">,</span> <span class="mf">1.001</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.001</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mf">1.001</span><span class="o">*</span><span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="p">])</span>
	<span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">END</span><span class="p">)</span>
	<span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="p">[</span> <span class="n">BEGIN</span><span class="p">,</span> <span class="n">LINES</span><span class="p">,</span> <span class="n">COLOR</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="p">]</span>  <span class="p">)</span>
	<span class="k">for</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">izip</span><span class="p">(</span><span class="n">crd</span><span class="p">,</span> <span class="n">cld</span><span class="p">,</span> <span class="n">lvl</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span> <span class="k">continue</span>
			<span class="c">#if v.z &gt;= 0:</span>
			<span class="k">for</span> <span class="n">vc</span> <span class="ow">in</span> <span class="p">(</span><span class="n">crd</span><span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="p">):</span>
					<span class="c">#if vc.z &gt; 0:</span>
					<span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">VERTEX</span><span class="p">,</span>  <span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>  <span class="n">v</span><span class="o">.</span><span class="n">y</span> <span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="p">])</span>
					<span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">VERTEX</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">vc</span><span class="o">.</span><span class="n">z</span> <span class="p">])</span>
	<span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">END</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&quot;hsphere&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="testsphere"><a class="viewcode-back" href="../pymol_util.html#pymol_util.testsphere">[docs]</a><span class="k">def</span> <span class="nf">testsphere</span><span class="p">():</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;s*&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;icos&#39;</span><span class="p">)</span>
	<span class="n">spheres</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">icos</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c">#   for i, n in enumerate((72, 132, 252, 492, 972, 1932, 3812, 7002, 13232, 25232, 50432)):</span>
	<span class="c">#for i, n in enumerate((72, 92, 122, 132, 162, 192, 212, 252, 272, 282, 312, 362, 372, 392, 432, 482, 492, 522, 572, 612, 632, 642, 672, 732, 752, 762, 792, 812, 842, 912, 932, 972, )):</span>
	<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">482</span><span class="p">,</span> <span class="mi">1922</span><span class="p">,</span> <span class="mi">7682</span><span class="p">,</span> <span class="mi">30722</span><span class="p">):</span>
	<span class="c">#for n in (32, 92, 272, 812, 2432):#, 482, 1922, 7682, 30722):</span>
		<span class="n">f</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">GzipFile</span><span class="p">(</span><span class="s">&quot;/Users/sheffler/Dropbox/project/sphere_hierarchy/att/sphere_</span><span class="si">%i</span><span class="s">.dat.gz&quot;</span><span class="o">%</span><span class="n">n</span><span class="p">)</span>
		<span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">floats2vecs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f</span><span class="p">))</span>
		<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="n">obj</span> <span class="o">=</span> <span class="p">[</span> <span class="n">BEGIN</span><span class="p">,</span> <span class="n">POINTS</span> <span class="p">,</span> <span class="n">COLOR</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="p">]</span>
		<span class="n">doneicos</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">icos</span> <span class="k">else</span> <span class="bp">False</span>
		<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
			<span class="c">#if (v.x &lt; 0 or v.y &lt; 0 or v.z &lt; 0): continue</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">doneicos</span> <span class="ow">and</span> <span class="n">nnb</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span> <span class="n">icos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
			<span class="c">#if v.x &gt;= 0 and v.y &gt;= 0 and v.z &gt;= 0: obj.extend([VERTEX,  v.x,  v.y,  v.z ])</span>
			<span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">VERTEX</span><span class="p">,</span>  <span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>  <span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>  <span class="n">v</span><span class="o">.</span><span class="n">z</span> <span class="p">])</span>
			<span class="c">#obj.extend([ VERTEX, v.x*0.86, v.y*0.86, v.z*0.86 ])</span>
		<span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">END</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&quot;s</span><span class="si">%i</span><span class="s">&quot;</span><span class="o">%</span><span class="n">n</span><span class="p">)</span>
		<span class="n">spheres</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
		<span class="c">#break</span>

	<span class="n">obj</span> <span class="o">=</span> <span class="p">[</span> <span class="n">BEGIN</span><span class="p">,</span> <span class="n">LINES</span><span class="p">,</span> <span class="n">COLOR</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="p">]</span>
	<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">icos</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">icos</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.1</span><span class="p">:</span>
				<span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">VERTEX</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>
				<span class="n">obj</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">VERTEX</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">z</span><span class="p">])</span>
				<span class="c"># if v.x &gt;= 0 and v.y &gt;= 0 and v.z &gt;= 0: obj.extend([VERTEX, v.x, v.y, v.z])</span>
				<span class="c"># if u.x &gt;= 0 and u.y &gt;= 0 and u.z &gt;= 0: obj.extend([VERTEX, u.x, u.y, u.z])</span>
	<span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">END</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">load_cgo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&quot;icos&quot;</span><span class="p">)</span>

	<span class="c"># samp = spheres[0]</span>
	<span class="c"># d = min(m.distance(n) for m in samp for n in samp if m is not n) * 1.5</span>
	<span class="c"># snew = list()</span>
	<span class="c"># for v in samp:</span>
	<span class="c">#   nb = [n for n in samp if 0.001 &lt; v.distance(n) &lt; d]</span>
	<span class="c">#   for c in (((v+m+n)/3.0).normalized() for m in nb for n in nb if 0.001 &lt; m.distance(n) &lt; d):</span>
	<span class="c">#       if not snew or min(x.distance(c) for x in snew) &gt; 0.001:</span>
	<span class="c">#           snew.append(c)</span>
	<span class="c"># snew.extend(samp)</span>
	<span class="c"># obj = [ BEGIN, POINTS, COLOR, 0.0, 0.0, 1.0, ]</span>
	<span class="c"># print len(snew)</span>
	<span class="c"># o = open(&quot;/Users/sheffler/Dropbox/project/sphere_hierarchy/sphere_%i.dat&quot;%len(snew), &#39;w&#39;)</span>
	<span class="c"># for v in snew:</span>
	<span class="c">#   print &gt;&gt;o, v.x</span>
	<span class="c">#   print &gt;&gt;o, v.y</span>
	<span class="c">#   print &gt;&gt;o, v.z</span>
	<span class="c">#   if v.z &gt; 0: obj.extend([VERTEX, v.x, v.y, v.z])</span>
	<span class="c"># o.close()</span>
	<span class="c"># obj.append(END)</span>
	<span class="c"># cmd.load_cgo(obj, &quot;snew&quot;)</span>

	<span class="c"># for s in sph:</span>
	<span class="c">#   print len(s), angle_degrees(s[0],s[1])</span>
	<span class="c"># test = list()</span>
	<span class="c"># for i in range(len(sph[-2])):</span>
	<span class="c">#   mn = 9e9; mni = -1</span>
	<span class="c">#   for j in range(len(sph[-1])):</span>
	<span class="c">#       d = sph[-2][i].distance(sph[-1][j])</span>
	<span class="c">#       if d &lt; mn:</span>
	<span class="c">#           mn = d</span>
	<span class="c">#           mni = j</span>
	<span class="c">#   test.append( sph[-1][mni] )</span>
	<span class="c">#   #sph[-1]    = sph[-1][:mni]+sph[-1][mni+1:]</span>
	<span class="c"># obj = [ BEGIN, POINTS, COLOR, 1.0, 0.0, 0.0, ]</span>
	<span class="c"># for v in test:</span>
	<span class="c">#   obj.extend([ VERTEX, v.x, v.y, v.z ])</span>
	<span class="c"># obj.append(END)</span>
	<span class="c"># cmd.load_cgo(obj, &quot;sphere1&quot;)</span>
	<span class="c"># obj = [ BEGIN, POINTS, COLOR, 0.0, 1.0, 0.0, ]</span>
	<span class="c"># for v in sph[-1]:</span>
	<span class="c">#   obj.extend([ VERTEX, v.x, v.y, v.z ])</span>
	<span class="c"># obj.append(END)</span>
	<span class="c"># cmd.load_cgo(obj, &quot;sphere2&quot;)</span>
</div>
<div class="viewcode-block" id="stubalign"><a class="viewcode-back" href="../pymol_util.html#pymol_util.stubalign">[docs]</a><span class="k">def</span> <span class="nf">stubalign</span><span class="p">(</span><span class="n">s</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span><span class="p">,</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">&#39;pk1&#39;</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">&#39;pk2&#39;</span><span class="p">,</span> <span class="n">s3</span> <span class="o">=</span> <span class="s">&#39;pk3&#39;</span><span class="p">):</span>
	<span class="n">trans</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="n">com</span><span class="p">(</span><span class="n">s1</span><span class="p">))</span>
	<span class="k">if</span> <span class="o">-</span><span class="mf">0.99999</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">com</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span><span class="o">-</span><span class="n">com</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">0.99999</span><span class="p">:</span> <span class="n">alignaxis</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">com</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span><span class="o">-</span><span class="n">com</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span>
	<span class="k">else</span><span class="p">:</span> <span class="k">print</span> <span class="s">&quot;alignaxis FUBAR!&quot;</span>
	<span class="n">y</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="n">s3</span><span class="p">)</span><span class="o">.</span><span class="n">y</span>
	<span class="n">z</span> <span class="o">=</span> <span class="n">com</span><span class="p">(</span><span class="n">s3</span><span class="p">)</span><span class="o">.</span><span class="n">z</span>
	<span class="k">if</span>   <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.00001</span><span class="p">:</span> <span class="n">ax</span> <span class="o">=</span>   <span class="mf">0.0</span> <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">180.0</span>
	<span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.00001</span><span class="p">:</span> <span class="n">ax</span> <span class="o">=</span> <span class="mf">270.0</span> <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span>  <span class="mf">90.0</span>
	<span class="k">else</span><span class="p">:</span>   <span class="n">ax</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
	<span class="n">rot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Ux</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="tmpdoit"><a class="viewcode-back" href="../pymol_util.html#pymol_util.tmpdoit">[docs]</a><span class="k">def</span> <span class="nf">tmpdoit</span><span class="p">():</span>
	<span class="n">axs</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;TET&quot;</span><span class="p">:(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span> <span class="mf">0.942809043336065</span><span class="p">,</span> <span class="mi">0</span>                <span class="p">,</span> <span class="o">-</span><span class="mf">0.333333328372267</span><span class="p">))</span><span class="o">.</span><span class="n">normalized</span><span class="p">(),</span>
		<span class="s">&quot;OCT&quot;</span><span class="p">:(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span> <span class="mf">0.666666666666667</span><span class="p">,</span> <span class="mf">0.666666666666667</span><span class="p">,</span> <span class="mf">0.333333333333333</span><span class="p">))</span><span class="o">.</span><span class="n">normalized</span><span class="p">(),</span>
		<span class="s">&quot;ICS&quot;</span><span class="p">:(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="o">-</span><span class="mf">0.333333320519719</span><span class="p">,</span> <span class="mf">0.57735021589134</span><span class="p">,</span>  <span class="mf">0.745356039515023</span><span class="p">))</span><span class="o">.</span><span class="n">normalized</span><span class="p">(),</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&quot;/Users/sheffler/project/111108_BPY_TOI/picksdone/*.pse&quot;</span><span class="p">):</span>
		<span class="k">print</span> <span class="n">fn</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">)</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
		<span class="n">sym</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
		<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">():</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;TET&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">o</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;OCT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">o</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;ICS&quot;</span><span class="p">)):</span>
				<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">sym</span> <span class="o">=</span> <span class="n">o</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">sym</span> <span class="o">==</span> <span class="s">&quot;TET&quot;</span><span class="p">:</span>
			<span class="n">cmd</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;not vis&quot;</span><span class="p">)</span>
			<span class="n">v</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mf">0.816496579408716</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.57735027133783</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
			<span class="n">rot</span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">)</span>
			<span class="n">cmd</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;.pse&quot;</span><span class="p">,</span> <span class="s">&quot;_A.pdb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;picksdone&quot;</span><span class="p">,</span> <span class="s">&quot;for_neil&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="symmetrizec2"><a class="viewcode-back" href="../pymol_util.html#pymol_util.symmetrizec2">[docs]</a><span class="k">def</span> <span class="nf">symmetrizec2</span><span class="p">(</span><span class="n">sel1</span><span class="p">,</span> <span class="n">sel2</span><span class="p">):</span>
	<span class="n">v</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;sA&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;sB&quot;</span><span class="p">)</span>
	<span class="k">print</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sel1</span><span class="p">)</span>
	<span class="k">print</span> <span class="n">cmd</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sel2</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;sA&quot;</span><span class="p">,</span> <span class="n">sel1</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;sB&quot;</span><span class="p">,</span> <span class="n">sel2</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;sA&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;A&#39;&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;sB&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;B&#39;&quot;</span><span class="p">)</span>
	<span class="n">a</span> <span class="o">=</span> <span class="n">c2axis</span><span class="p">(</span><span class="s">&quot;(sA or sB)&quot;</span><span class="p">)</span>
	<span class="n">alignaxis</span><span class="p">(</span><span class="s">&quot;(sA or sB)&quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
	<span class="n">trans</span><span class="p">(</span><span class="s">&quot;sA&quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">com</span><span class="p">(</span><span class="s">&quot;sA&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
	<span class="n">trans</span><span class="p">(</span><span class="s">&quot;sB&quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">com</span><span class="p">(</span><span class="s">&quot;sB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&quot;sB&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;sB&quot;</span><span class="p">,</span> <span class="s">&quot;sA&quot;</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="s">&quot;sB&quot;</span><span class="p">,</span> <span class="s">&quot;chain = &#39;B&#39;&quot;</span><span class="p">)</span>
	<span class="n">rot</span><span class="p">(</span><span class="s">&quot;sB&quot;</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">180.0</span><span class="p">)</span>
	<span class="n">cmd</span><span class="o">.</span><span class="n">set_view</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>



</div>
<div class="viewcode-block" id="corresponding_atom_names"><a class="viewcode-back" href="../pymol_util.html#pymol_util.corresponding_atom_names">[docs]</a><span class="k">def</span> <span class="nf">corresponding_atom_names</span><span class="p">(</span><span class="n">sel1</span><span class="p">,</span><span class="n">sel2</span><span class="p">,</span><span class="nb">file</span><span class="p">):</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
	<span class="n">m1</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel1</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span>
	<span class="n">m2</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="n">sel2</span><span class="p">)</span><span class="o">.</span><span class="n">atom</span>
	<span class="n">fr</span><span class="o">=</span><span class="p">[]</span>
	<span class="n">to</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">for</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">m1</span><span class="p">:</span>
		<span class="n">mn</span> <span class="o">=</span> <span class="mf">9e9</span>
		<span class="n">mi</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">for</span> <span class="n">a2</span> <span class="ow">in</span> <span class="n">m2</span><span class="p">:</span>
			<span class="n">d</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">coord</span><span class="p">)</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">Vec</span><span class="p">(</span><span class="n">a2</span><span class="o">.</span><span class="n">coord</span><span class="p">))</span>
			<span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">mn</span><span class="p">:</span>
				<span class="n">mi</span> <span class="o">=</span> <span class="n">a2</span>
				<span class="n">mn</span> <span class="o">=</span> <span class="n">d</span>
		<span class="n">fr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mi</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
		<span class="n">to</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="s">&quot;&quot;</span><span class="p">))</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fr</span><span class="p">)):</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">b&quot;</span><span class="o">+</span><span class="n">fr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\\</span><span class="s">b&quot;</span><span class="p">,</span><span class="n">to</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">s</span><span class="p">)</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="o">+</span><span class="s">&quot;.rename&quot;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">o</span><span class="p">:</span>
		<span class="n">o</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
	<span class="k">print</span> <span class="s">&quot;wrote&quot;</span><span class="p">,</span><span class="nb">file</span><span class="o">+</span><span class="s">&quot;.rename&quot;</span>



</div>
<div class="viewcode-block" id="bestalign"><a class="viewcode-back" href="../pymol_util.html#pymol_util.bestalign">[docs]</a><span class="k">def</span> <span class="nf">bestalign</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">):</span>
	<span class="n">ol1</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">s1</span><span class="p">)]</span>
	<span class="n">ol2</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cmd</span><span class="o">.</span><span class="n">get_object_list</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">s2</span><span class="p">)]</span>
	<span class="n">keepers</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">o1</span> <span class="ow">in</span> <span class="n">ol1</span><span class="p">:</span>
		<span class="n">mn</span> <span class="o">=</span> <span class="mf">9e9</span>
		<span class="n">mo</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">for</span> <span class="n">o2</span> <span class="ow">in</span> <span class="n">ol2</span><span class="p">:</span>
			<span class="n">r</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">o1</span><span class="p">,</span><span class="n">o2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">mn</span><span class="p">:</span>
				<span class="n">mn</span> <span class="o">=</span> <span class="n">r</span>
				<span class="n">mo</span> <span class="o">=</span> <span class="n">o2</span>
		<span class="n">cmd</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">o1</span><span class="p">,</span><span class="n">mo</span><span class="p">)</span>
		<span class="n">keepers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
		<span class="k">print</span> <span class="s">&quot;</span><span class="si">%7.3f</span><span class="s">    </span><span class="si">%10s</span><span class="s"> </span><span class="si">%10s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span><span class="n">o1</span><span class="p">,</span><span class="n">mo</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">o2</span> <span class="ow">in</span> <span class="n">ol2</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">o2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keepers</span><span class="p">:</span>
			<span class="n">cmd</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">o2</span><span class="p">)</span>


</div>
<span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&quot;com&quot;</span><span class="p">,</span> <span class="n">com</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&quot;showcom&quot;</span><span class="p">,</span> <span class="n">showcom</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&quot;axisofrot&quot;</span><span class="p">,</span> <span class="n">axisofrot</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&quot;bond_zns&quot;</span><span class="p">,</span> <span class="n">bond_zns</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&quot;meancoords&quot;</span><span class="p">,</span> <span class="n">meancoords</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&quot;swell&quot;</span><span class="p">,</span> <span class="n">swell</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&quot;axes&quot;</span><span class="p">,</span><span class="n">showaxes</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&#39;useRosettaRadii&#39;</span><span class="p">,</span> <span class="n">useRosettaRadii</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&#39;expandRadii&#39;</span><span class="p">,</span><span class="n">expandRadii</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&#39;contractRadii&#39;</span><span class="p">,</span><span class="n">contractRadii</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">Will&#39;s PyMOL Scripts 0.2 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Will Sheffler.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>